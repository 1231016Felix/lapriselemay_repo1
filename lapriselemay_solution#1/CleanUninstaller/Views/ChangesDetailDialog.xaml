<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="CleanUninstaller.Views.ChangesDetailDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:CleanUninstaller.Models"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="DÃ©tails des changements"
    PrimaryButtonText="DÃ©sinstaller sÃ©lection"
    SecondaryButtonText="Fermer"
    DefaultButton="Secondary"
    CloseButtonText=""
    MinWidth="900"
    MinHeight="600">

    <Grid Width="850" Height="550">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- En-tÃªte avec statistiques -->
        <Border Grid.Row="0" 
                Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                CornerRadius="8"
                Padding="16"
                Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                    <TextBlock x:Name="FilesCountText" 
                               Text="0" 
                               Style="{StaticResource TitleTextBlockStyle}"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="Fichiers" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Opacity="0.7"
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock x:Name="RegistryCountText" 
                               Text="0" 
                               Style="{StaticResource TitleTextBlockStyle}"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="Registre" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Opacity="0.7"
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock x:Name="ServicesCountText" 
                               Text="0" 
                               Style="{StaticResource TitleTextBlockStyle}"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="Services" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Opacity="0.7"
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <TextBlock x:Name="OthersCountText" 
                               Text="0" 
                               Style="{StaticResource TitleTextBlockStyle}"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="Autres" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Opacity="0.7"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Filtres -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
            <ComboBox x:Name="CategoryFilter" 
                      PlaceholderText="Toutes catÃ©gories"
                      Width="180"
                      SelectionChanged="CategoryFilter_SelectionChanged">
                <ComboBoxItem Content="Toutes catÃ©gories" Tag=""/>
                <ComboBoxItem Content="ðŸ“„ Fichiers" Tag="File"/>
                <ComboBoxItem Content="ðŸ“ Dossiers" Tag="Folder"/>
                <ComboBoxItem Content="ðŸ”‘ ClÃ©s registre" Tag="RegistryKey"/>
                <ComboBoxItem Content="ðŸ“ Valeurs registre" Tag="RegistryValue"/>
                <ComboBoxItem Content="âš™ï¸ Services" Tag="Service"/>
                <ComboBoxItem Content="ðŸ“… TÃ¢ches planifiÃ©es" Tag="ScheduledTask"/>
                <ComboBoxItem Content="ðŸ›¡ï¸ RÃ¨gles pare-feu" Tag="FirewallRule"/>
                <ComboBoxItem Content="ðŸš€ DÃ©marrage" Tag="StartupEntry"/>
                <ComboBoxItem Content="ðŸŒ Variables env." Tag="EnvironmentVariable"/>
                <ComboBoxItem Content="ðŸ’¾ Pilotes" Tag="Driver"/>
                <ComboBoxItem Content="ðŸ”§ Objets COM" Tag="ComObject"/>
                <ComboBoxItem Content="ðŸ”— Associations" Tag="FileAssociation"/>
                <ComboBoxItem Content="ðŸ”¤ Polices" Tag="Font"/>
                <ComboBoxItem Content="ðŸ“‚ Extensions shell" Tag="ShellExtension"/>
            </ComboBox>

            <ComboBox x:Name="ChangeTypeFilter" 
                      PlaceholderText="Tous types"
                      Width="140"
                      SelectionChanged="ChangeTypeFilter_SelectionChanged">
                <ComboBoxItem Content="Tous types" Tag=""/>
                <ComboBoxItem Content="âž• CrÃ©Ã©" Tag="Created"/>
                <ComboBoxItem Content="âœï¸ ModifiÃ©" Tag="Modified"/>
                <ComboBoxItem Content="âŒ SupprimÃ©" Tag="Deleted"/>
            </ComboBox>

            <AutoSuggestBox x:Name="SearchBox" 
                            PlaceholderText="Rechercher..."
                            QueryIcon="Find"
                            Width="200"
                            TextChanged="SearchBox_TextChanged"/>

            <Button Content="âœ… Tout sÃ©lectionner" Click="SelectAll_Click"/>
            <Button Content="â¬œ Tout dÃ©sÃ©lectionner" Click="DeselectAll_Click"/>
        </StackPanel>

        <!-- Liste des changements -->
        <ListView Grid.Row="2" 
                  x:Name="ChangesListView"
                  SelectionMode="None"
                  IsItemClickEnabled="False">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:SystemChange">
                    <Grid Padding="8,6" ColumnSpacing="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Checkbox -->
                        <CheckBox Grid.Column="0" 
                                  IsChecked="{x:Bind IsSelected, Mode=TwoWay}"
                                  MinWidth="0"
                                  Padding="0"/>

                        <!-- IcÃ´ne type de changement -->
                        <Border Grid.Column="1" 
                                Background="{x:Bind ChangeTypeColor}"
                                CornerRadius="4"
                                Padding="4,2"
                                VerticalAlignment="Center">
                            <TextBlock Text="{x:Bind ChangeTypeName}" 
                                       FontSize="10"
                                       Foreground="White"/>
                        </Border>

                        <!-- IcÃ´ne catÃ©gorie -->
                        <FontIcon Grid.Column="2" 
                                  Glyph="{x:Bind CategoryIcon}" 
                                  FontSize="16"
                                  VerticalAlignment="Center"
                                  ToolTipService.ToolTip="{x:Bind CategoryName}"/>

                        <!-- Chemin -->
                        <TextBlock Grid.Column="3" 
                                   Text="{x:Bind Path}" 
                                   TextTrimming="CharacterEllipsis"
                                   VerticalAlignment="Center"
                                   ToolTipService.ToolTip="{x:Bind Path}"/>

                        <!-- Taille -->
                        <TextBlock Grid.Column="4" 
                                   Text="{x:Bind FormattedSize}" 
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Opacity="0.6"
                                   VerticalAlignment="Center"
                                   Width="70"
                                   TextAlignment="Right"/>

                        <!-- Statut -->
                        <FontIcon Grid.Column="5" 
                                  Glyph="{x:Bind IsReverted, Converter={StaticResource BoolToIconConverter}}"
                                  FontSize="14"
                                  Foreground="{x:Bind IsReverted, Converter={StaticResource BoolToColorConverter}}"
                                  Visibility="{x:Bind IsReverted}"
                                  ToolTipService.ToolTip="SupprimÃ©"/>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Pied de page -->
        <Border Grid.Row="3" 
                Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                CornerRadius="8"
                Padding="16"
                Margin="0,16,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16">
                    <TextBlock VerticalAlignment="Center">
                        <Run Text="SÃ©lectionnÃ©s:"/>
                        <Run x:Name="SelectedCountRun" Text="0" FontWeight="SemiBold"/>
                    </TextBlock>
                    <TextBlock VerticalAlignment="Center">
                        <Run Text="Taille:"/>
                        <Run x:Name="SelectedSizeRun" Text="0 Ko" FontWeight="SemiBold"/>
                    </TextBlock>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button Content="ðŸ“ Fichiers uniquement" Click="SelectFilesOnly_Click"/>
                    <Button Content="ðŸ”‘ Registre uniquement" Click="SelectRegistryOnly_Click"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</ContentDialog>
