<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="CleanUninstaller.Views.EnhancedInstallationMonitorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:CleanUninstaller.Views"
    xmlns:models="using:CleanUninstaller.Models"
    xmlns:services="using:CleanUninstaller.Services"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="Transparent">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- En-tÃªte -->
        <Grid Grid.Row="0" Padding="24,16,24,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Spacing="4">
                <TextBlock Text="ðŸ›¡ï¸ Moniteur d'installation" 
                           Style="{StaticResource TitleTextBlockStyle}"
                           FontWeight="SemiBold"/>
                <TextBlock Text="Surveillez une installation pour une dÃ©sinstallation parfaite et sans rÃ©sidus"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           Opacity="0.7"/>
            </StackPanel>

            <!-- Indicateur de statut global -->
            <Border Grid.Column="1" 
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    CornerRadius="8"
                    Padding="16,8"
                    Visibility="{x:Bind ViewModel.HasCurrentMonitoring, Mode=OneWay}">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <ProgressRing IsActive="{x:Bind ViewModel.IsMonitoring, Mode=OneWay}" 
                                  Width="20" Height="20"/>
                    <TextBlock Text="{x:Bind ViewModel.MonitoringDuration, Mode=OneWay}"
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               FontFamily="Consolas"/>
                    <TextBlock Text="|" Opacity="0.3"/>
                    <TextBlock Style="{StaticResource BodyTextBlockStyle}">
                        <Run Text="{x:Bind ViewModel.RealTimeChangeCount, Mode=OneWay}"/>
                        <Run Text="changements"/>
                    </TextBlock>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Contenu principal avec pivot/tabs -->
        <Pivot Grid.Row="1" Padding="16,0">
            <!-- Tab 1: Nouvelle surveillance -->
            <PivotItem Header="ðŸŽ¯ Nouvelle surveillance">
                <ScrollViewer Padding="8">
                    <Grid ColumnSpacing="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" MaxWidth="500"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Panneau de contrÃ´le -->
                        <StackPanel Grid.Column="0" Spacing="16">
                            <!-- Carte de configuration -->
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="20">
                                <StackPanel Spacing="16">
                                    <TextBlock Text="Configuration" 
                                               Style="{StaticResource SubtitleTextBlockStyle}"
                                               FontWeight="SemiBold"/>

                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Nom de l'application *" Opacity="0.7"/>
                                        <TextBox PlaceholderText="Ex: Visual Studio Code, Firefox..."
                                                 Text="{x:Bind ViewModel.InstallationName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 IsEnabled="{x:Bind ViewModel.CanStart, Mode=OneWay}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Chemin de l'installeur (optionnel)" Opacity="0.7"/>
                                        <Grid ColumnSpacing="8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0"
                                                     PlaceholderText="C:\Downloads\setup.exe"
                                                     Text="{x:Bind ViewModel.InstallerPath, Mode=TwoWay}"
                                                     IsEnabled="{x:Bind ViewModel.CanStart, Mode=OneWay}"/>
                                            <Button Grid.Column="1" 
                                                    Content="ðŸ“" 
                                                    Click="BrowseInstaller_Click"
                                                    IsEnabled="{x:Bind ViewModel.CanStart, Mode=OneWay}"
                                                    ToolTipService.ToolTip="Parcourir..."/>
                                        </Grid>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <!-- Boutons de contrÃ´le -->
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="20">
                                <StackPanel Spacing="16">
                                    <TextBlock Text="ContrÃ´les" 
                                               Style="{StaticResource SubtitleTextBlockStyle}"
                                               FontWeight="SemiBold"/>

                                    <Grid ColumnSpacing="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <Button Grid.Column="0"
                                                Content="ðŸ”´ DÃ©marrer"
                                                Command="{x:Bind ViewModel.StartMonitoringCommand}"
                                                Style="{StaticResource AccentButtonStyle}"
                                                HorizontalAlignment="Stretch"
                                                Padding="16,12"/>

                                        <Button Grid.Column="1"
                                                Content="â¹ï¸ ArrÃªter"
                                                Command="{x:Bind ViewModel.StopMonitoringCommand}"
                                                HorizontalAlignment="Stretch"
                                                Padding="16,12"/>
                                    </Grid>

                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Button Content="â¸ï¸" 
                                                Command="{x:Bind ViewModel.PauseMonitoringCommand}"
                                                ToolTipService.ToolTip="Pause"/>
                                        <Button Content="â–¶ï¸" 
                                                Command="{x:Bind ViewModel.ResumeMonitoringCommand}"
                                                ToolTipService.ToolTip="Reprendre"/>
                                        <Button Content="âŒ" 
                                                Command="{x:Bind ViewModel.CancelMonitoringCommand}"
                                                ToolTipService.ToolTip="Annuler"/>
                                    </StackPanel>

                                    <!-- Progression -->
                                    <StackPanel Spacing="4" 
                                                Visibility="{x:Bind ViewModel.IsBusy, Mode=OneWay}">
                                        <ProgressBar Value="{x:Bind ViewModel.Progress, Mode=OneWay}"
                                                     Maximum="100"/>
                                        <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   TextWrapping="Wrap"
                                                   Opacity="0.7"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <!-- Statistiques temps rÃ©el -->
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="20"
                                    Visibility="{x:Bind ViewModel.HasCurrentMonitoring, Mode=OneWay}">
                                <StackPanel Spacing="12">
                                    <TextBlock Text="ðŸ“Š Statistiques temps rÃ©el" 
                                               Style="{StaticResource SubtitleTextBlockStyle}"
                                               FontWeight="SemiBold"/>

                                    <Grid ColumnSpacing="16" RowSpacing="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <StackPanel Grid.Column="0" Grid.Row="0">
                                            <TextBlock Text="ðŸ“„ Fichiers" Opacity="0.6" FontSize="12"/>
                                            <TextBlock Text="{x:Bind ViewModel.FilesDetectedCount, Mode=OneWay}"
                                                       Style="{StaticResource SubtitleTextBlockStyle}"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Grid.Row="0">
                                            <TextBlock Text="ðŸ“ Dossiers" Opacity="0.6" FontSize="12"/>
                                            <TextBlock Text="{x:Bind ViewModel.FoldersDetectedCount, Mode=OneWay}"
                                                       Style="{StaticResource SubtitleTextBlockStyle}"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="0" Grid.Row="1">
                                            <TextBlock Text="ðŸ”‘ Registre" Opacity="0.6" FontSize="12"/>
                                            <TextBlock Text="{x:Bind ViewModel.RegistryDetectedCount, Mode=OneWay}"
                                                       Style="{StaticResource SubtitleTextBlockStyle}"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Grid.Row="1">
                                            <TextBlock Text="âš™ï¸ Processus" Opacity="0.6" FontSize="12"/>
                                            <TextBlock Text="{x:Bind ViewModel.ProcessesDetectedCount, Mode=OneWay}"
                                                       Style="{StaticResource SubtitleTextBlockStyle}"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Processus d'installation dÃ©tectÃ©s -->
                            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="20"
                                    Visibility="{x:Bind ViewModel.HasCurrentMonitoring, Mode=OneWay}">
                                <StackPanel Spacing="8">
                                    <TextBlock Text="ðŸ”§ Processus d'installation" 
                                               Style="{StaticResource SubtitleTextBlockStyle}"
                                               FontWeight="SemiBold"/>

                                    <ListView ItemsSource="{x:Bind ViewModel.ActiveProcesses, Mode=OneWay}"
                                              SelectionMode="None"
                                              MaxHeight="150">
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="services:ProcessInfo">
                                                <Grid Padding="4" ColumnSpacing="8">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <FontIcon Grid.Column="0" Glyph="&#xE7EE;" FontSize="12"/>
                                                    <TextBlock Grid.Column="1" 
                                                               Text="{x:Bind ProcessName}"
                                                               TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Grid.Column="2" 
                                                               Text="{x:Bind ProcessId}"
                                                               Opacity="0.5"
                                                               FontSize="11"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>

                                    <TextBlock Text="Aucun processus d'installation dÃ©tectÃ©"
                                               Opacity="0.5"
                                               FontStyle="Italic"
                                               Visibility="{x:Bind ViewModel.ActiveProcesses.Count, Mode=OneWay, Converter={StaticResource ZeroToVisibleConverter}, FallbackValue=Visible}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Liste des changements temps rÃ©el -->
                        <Border Grid.Column="1"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Visibility="{x:Bind ViewModel.HasCurrentMonitoring, Mode=OneWay}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Padding="20,16,20,8" Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="ðŸ“‹ Changements en direct" 
                                               Style="{StaticResource SubtitleTextBlockStyle}"/>
                                    <Border Background="{ThemeResource AccentFillColorDefaultBrush}"
                                            CornerRadius="10"
                                            Padding="8,2">
                                        <TextBlock Text="{x:Bind ViewModel.RealTimeChangeCount, Mode=OneWay}"
                                                   FontSize="11"
                                                   Foreground="White"/>
                                    </Border>
                                </StackPanel>

                                <ListView Grid.Row="1" 
                                          ItemsSource="{x:Bind ViewModel.RealTimeChanges, Mode=OneWay}"
                                          SelectionMode="None"
                                          Padding="8">
                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="models:SystemChange">
                                            <Grid Padding="8,6" ColumnSpacing="8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <FontIcon Grid.Column="0" 
                                                          Glyph="{x:Bind ChangeTypeIcon}" 
                                                          FontSize="12"
                                                          Foreground="{x:Bind ChangeTypeColor}"/>

                                                <FontIcon Grid.Column="1" 
                                                          Glyph="{x:Bind CategoryIcon}" 
                                                          FontSize="12"
                                                          Opacity="0.6"/>

                                                <TextBlock Grid.Column="2" 
                                                           Text="{x:Bind DisplayPath}" 
                                                           TextTrimming="CharacterEllipsis"
                                                           ToolTipService.ToolTip="{x:Bind Path}"/>

                                                <TextBlock Grid.Column="3" 
                                                           Text="{x:Bind FormattedSize}" 
                                                           Opacity="0.5"
                                                           FontSize="11"/>

                                                <TextBlock Grid.Column="4" 
                                                           Text="{x:Bind FormattedTimestamp}" 
                                                           Opacity="0.4"
                                                           FontSize="10"
                                                           FontFamily="Consolas"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Grid>
                        </Border>

                        <!-- Message d'attente quand pas de monitoring -->
                        <Border Grid.Column="1"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="40"
                                Visibility="{x:Bind ViewModel.HasCurrentMonitoring, Mode=OneWay, Converter={StaticResource BoolToInverseVisibilityConverter}}">
                            <StackPanel HorizontalAlignment="Center" 
                                        VerticalAlignment="Center"
                                        Spacing="16">
                                <FontIcon Glyph="&#xE895;" FontSize="48" Opacity="0.3"/>
                                <TextBlock Text="Cliquez sur 'DÃ©marrer' pour commencer la surveillance"
                                           Style="{StaticResource BodyTextBlockStyle}"
                                           Opacity="0.5"
                                           TextAlignment="Center"/>
                                <TextBlock Text="Les changements systÃ¨me seront dÃ©tectÃ©s en temps rÃ©el"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Opacity="0.4"
                                           TextAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </ScrollViewer>
            </PivotItem>

            <!-- Tab 2: Installations surveillÃ©es -->
            <PivotItem Header="ðŸ“ Installations surveillÃ©es">
                <Grid Padding="8" ColumnSpacing="24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="350"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Liste des installations -->
                    <Border Grid.Column="0"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" 
                                       Text="Historique des installations"
                                       Style="{StaticResource SubtitleTextBlockStyle}"
                                       Margin="16,12"/>

                            <ListView Grid.Row="1"
                                      ItemsSource="{x:Bind ViewModel.SavedInstallations, Mode=OneWay}"
                                      SelectedItem="{x:Bind ViewModel.SelectedInstallation, Mode=TwoWay}"
                                      SelectionMode="Single"
                                      Padding="8">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="models:MonitoredInstallation">
                                        <Grid Padding="8" RowSpacing="4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <StackPanel Grid.Row="0" Grid.Column="0" 
                                                        Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="{x:Bind Name}" 
                                                           Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                                <Border Background="{ThemeResource SystemFillColorSuccessBackgroundBrush}"
                                                        CornerRadius="4"
                                                        Padding="6,2"
                                                        Visibility="{x:Bind IsUninstalled}">
                                                    <TextBlock Text="âœ“" FontSize="10"/>
                                                </Border>
                                            </StackPanel>

                                            <Button Grid.Row="0" Grid.Column="1"
                                                    Content="ðŸ—‘ï¸"
                                                    Background="Transparent"
                                                    Padding="4"
                                                    Click="DeleteInstallation_Click"
                                                    Tag="{x:Bind}"/>

                                            <TextBlock Grid.Row="1" Grid.ColumnSpan="2"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Opacity="0.7">
                                                <Run Text="{x:Bind Statistics.TotalChanges}"/>
                                                <Run Text="changements â€¢"/>
                                                <Run Text="{x:Bind FormattedTotalSize}"/>
                                            </TextBlock>

                                            <TextBlock Grid.Row="2" Grid.ColumnSpan="2"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Opacity="0.5"
                                                       Text="{x:Bind StartTime}"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Grid>
                    </Border>

                    <!-- DÃ©tails et actions -->
                    <Grid Grid.Column="1" RowSpacing="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Actions -->
                        <Border Grid.Row="0"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="16"
                                Visibility="{x:Bind ViewModel.HasSelectedInstallation, Mode=OneWay}">
                            <Grid RowSpacing="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8">
                                    <Button Content="ðŸ§¹ DÃ©sinstallation parfaite"
                                            Command="{x:Bind ViewModel.PerfectUninstallCommand}"
                                            Style="{StaticResource AccentButtonStyle}"/>
                                    <Button Content="ðŸ“¤ Exporter"
                                            Command="{x:Bind ViewModel.ExportChangesCommand}"/>
                                    <CheckBox Content="CrÃ©er sauvegarde"
                                              IsChecked="{x:Bind ViewModel.CreateBackupBeforeUninstall, Mode=TwoWay}"
                                              VerticalAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="8">
                                    <Button Content="âœ… Tout" 
                                            Command="{x:Bind ViewModel.SelectAllChangesCommand}"
                                            Padding="8,4"/>
                                    <Button Content="â¬œ Rien" 
                                            Command="{x:Bind ViewModel.DeselectAllChangesCommand}"
                                            Padding="8,4"/>
                                    <Button Content="ðŸ“„ Fichiers" 
                                            Command="{x:Bind ViewModel.SelectFilesOnlyCommand}"
                                            Padding="8,4"/>
                                    <Button Content="ðŸ”‘ Registre" 
                                            Command="{x:Bind ViewModel.SelectRegistryOnlyCommand}"
                                            Padding="8,4"/>
                                    <Button Content="ðŸ”„ Inverser" 
                                            Command="{x:Bind ViewModel.InvertSelectionCommand}"
                                            Padding="8,4"/>
                                </StackPanel>

                                <TextBlock Grid.Row="2" Style="{StaticResource CaptionTextBlockStyle}">
                                    <Run Text="{x:Bind ViewModel.SelectedChangesCount, Mode=OneWay}"/>
                                    <Run Text="Ã©lÃ©ments sÃ©lectionnÃ©s â€¢"/>
                                    <Run Text="{x:Bind ViewModel.FormattedSelectedSize, Mode=OneWay}"/>
                                </TextBlock>
                            </Grid>
                        </Border>

                        <!-- Liste des changements de l'installation sÃ©lectionnÃ©e -->
                        <Border Grid.Row="1"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Visibility="{x:Bind ViewModel.HasSelectedInstallation, Mode=OneWay}">
                            <ListView ItemsSource="{x:Bind ViewModel.SelectedInstallation.Changes, Mode=OneWay}"
                                      SelectionMode="None"
                                      Padding="8">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="models:SystemChange">
                                        <Grid Padding="8,6" ColumnSpacing="8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <CheckBox Grid.Column="0" 
                                                      IsChecked="{x:Bind IsSelected, Mode=TwoWay}"
                                                      MinWidth="0"/>

                                            <FontIcon Grid.Column="1" 
                                                      Glyph="{x:Bind ChangeTypeIcon}" 
                                                      FontSize="14"
                                                      Foreground="{x:Bind ChangeTypeColor}"/>

                                            <FontIcon Grid.Column="2" 
                                                      Glyph="{x:Bind CategoryIcon}" 
                                                      FontSize="14"
                                                      Opacity="0.6"/>

                                            <StackPanel Grid.Column="3">
                                                <TextBlock Text="{x:Bind DisplayPath}" 
                                                           TextTrimming="CharacterEllipsis"
                                                           ToolTipService.ToolTip="{x:Bind Path}"/>
                                                <TextBlock Text="{x:Bind CategoryName}"
                                                           Style="{StaticResource CaptionTextBlockStyle}"
                                                           Opacity="0.5"/>
                                            </StackPanel>

                                            <TextBlock Grid.Column="4" 
                                                       Text="{x:Bind FormattedSize}"
                                                       Opacity="0.5"
                                                       VerticalAlignment="Center"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Border>

                        <!-- Message quand rien n'est sÃ©lectionnÃ© -->
                        <Border Grid.Row="1"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8"
                                Padding="40"
                                Visibility="{x:Bind ViewModel.HasSelectedInstallation, Mode=OneWay, Converter={StaticResource BoolToInverseVisibilityConverter}}">
                            <StackPanel HorizontalAlignment="Center" 
                                        VerticalAlignment="Center"
                                        Spacing="12">
                                <FontIcon Glyph="&#xE8B7;" FontSize="48" Opacity="0.3"/>
                                <TextBlock Text="SÃ©lectionnez une installation pour voir ses dÃ©tails"
                                           Opacity="0.5"/>
                            </StackPanel>
                        </Border>

                        <!-- RÃ©sumÃ© statistiques -->
                        <Border Grid.Row="2"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="16"
                                Visibility="{x:Bind ViewModel.HasSelectedInstallation, Mode=OneWay}">
                            <Grid ColumnSpacing="24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="ðŸ“„ Fichiers" Opacity="0.6" FontSize="12"/>
                                    <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">
                                        <Run Text="{x:Bind ViewModel.SelectedInstallation.Statistics.FilesCreated, Mode=OneWay, FallbackValue='0'}"/>
                                    </TextBlock>
                                </StackPanel>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="ðŸ“ Dossiers" Opacity="0.6" FontSize="12"/>
                                    <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">
                                        <Run Text="{x:Bind ViewModel.SelectedInstallation.Statistics.FoldersCreated, Mode=OneWay, FallbackValue='0'}"/>
                                    </TextBlock>
                                </StackPanel>

                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="ðŸ”‘ Registre" Opacity="0.6" FontSize="12"/>
                                    <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">
                                        <Run Text="{x:Bind ViewModel.SelectedInstallation.Statistics.RegistryKeysCreated, Mode=OneWay, FallbackValue='0'}"/>
                                    </TextBlock>
                                </StackPanel>

                                <StackPanel Grid.Column="3">
                                    <TextBlock Text="âš™ï¸ Services" Opacity="0.6" FontSize="12"/>
                                    <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">
                                        <Run Text="{x:Bind ViewModel.SelectedInstallation.Statistics.ServicesCreated, Mode=OneWay, FallbackValue='0'}"/>
                                    </TextBlock>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>
            </PivotItem>

            <!-- Tab 3: Sauvegardes -->
            <PivotItem Header="ðŸ’¾ Sauvegardes">
                <Grid Padding="8" ColumnSpacing="24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="350"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Liste des sauvegardes -->
                    <Border Grid.Column="0"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" 
                                       Text="Sauvegardes disponibles"
                                       Style="{StaticResource SubtitleTextBlockStyle}"
                                       Margin="16,12"/>

                            <ListView Grid.Row="1"
                                      ItemsSource="{x:Bind ViewModel.AvailableBackups, Mode=OneWay}"
                                      SelectedItem="{x:Bind ViewModel.SelectedBackup, Mode=TwoWay}"
                                      SelectionMode="Single"
                                      Padding="8">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="services:UninstallBackup">
                                        <Grid Padding="8" RowSpacing="4">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <TextBlock Grid.Row="0" 
                                                       Text="{x:Bind InstallationName}"
                                                       Style="{StaticResource BodyStrongTextBlockStyle}"/>

                                            <TextBlock Grid.Row="1"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Opacity="0.6">
                                                <Run Text="{x:Bind CreatedAt}"/>
                                                <Run Text="â€¢"/>
                                                <Run Text="{x:Bind BackedUpItems.Count}"/>
                                                <Run Text="Ã©lÃ©ments"/>
                                            </TextBlock>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Grid>
                    </Border>

                    <!-- Actions de restauration -->
                    <Border Grid.Column="1"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="24">
                        <StackPanel Spacing="16" 
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                            <FontIcon Glyph="&#xE777;" FontSize="48" Opacity="0.5"/>
                            <TextBlock Text="Restauration de sauvegarde"
                                       Style="{StaticResource SubtitleTextBlockStyle}"
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="SÃ©lectionnez une sauvegarde pour restaurer les fichiers supprimÃ©s lors d'une dÃ©sinstallation"
                                       TextAlignment="Center"
                                       Opacity="0.6"
                                       TextWrapping="Wrap"
                                       MaxWidth="400"/>
                            
                            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                                <Button Content="ðŸ”„ Restaurer"
                                        Command="{x:Bind ViewModel.RestoreBackupCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        IsEnabled="{x:Bind ViewModel.SelectedBackup, Mode=OneWay, Converter={StaticResource NullToBoolConverter}}"/>
                                <Button Content="ðŸ—‘ï¸ Supprimer"
                                        Click="DeleteBackup_Click"
                                        IsEnabled="{x:Bind ViewModel.SelectedBackup, Mode=OneWay, Converter={StaticResource NullToBoolConverter}}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>
            </PivotItem>
        </Pivot>

        <!-- Barre de statut -->
        <Border Grid.Row="1" 
                VerticalAlignment="Bottom"
                Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                Padding="16,8">
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       Opacity="0.8"/>
        </Border>
    </Grid>
</Page>
