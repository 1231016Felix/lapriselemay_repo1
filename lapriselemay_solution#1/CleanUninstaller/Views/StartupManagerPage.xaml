<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="CleanUninstaller.Views.StartupManagerPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:CleanUninstaller.Views"
    xmlns:models="using:CleanUninstaller.Models"
    Background="Transparent">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- En-tête -->
        <Grid Grid.Row="0" Padding="24,16,24,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Spacing="4">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <TextBlock Text="⚡ Programmes au démarrage" 
                               Style="{StaticResource TitleTextBlockStyle}"
                               FontWeight="SemiBold"/>
                    <InfoBadge x:Name="AdminBadge"
                               Style="{StaticResource CriticalIconInfoBadgeStyle}"
                               ToolTipService.ToolTip="Mode administrateur requis pour certaines opérations"
                               Visibility="{x:Bind ViewModel.IsAdministrator, Converter={StaticResource BoolToInverseVisibilityConverter}}"/>
                </StackPanel>
                <TextBlock Text="Gérez les programmes qui se lancent automatiquement au démarrage de Windows"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           Opacity="0.7"/>
            </StackPanel>

            <Button Grid.Column="1" 
                    Command="{x:Bind ViewModel.RefreshCommand}"
                    Style="{StaticResource AccentButtonStyle}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE72C;" FontSize="14"/>
                    <TextBlock Text="Actualiser"/>
                </StackPanel>
            </Button>
        </Grid>

        <!-- Statistiques -->
        <Border Grid.Row="1" 
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                Margin="24,8"
                CornerRadius="8"
                Padding="20,16">
            <Grid ColumnSpacing="32">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                    <TextBlock Text="{x:Bind ViewModel.TotalCount, Mode=OneWay}" 
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               HorizontalAlignment="Center"
                               FontWeight="Bold"/>
                    <TextBlock Text="Total" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Opacity="0.6"
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="{x:Bind ViewModel.EnabledCount, Mode=OneWay}" 
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               Foreground="Green"
                               HorizontalAlignment="Center"
                               FontWeight="Bold"/>
                    <TextBlock Text="Activés" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Opacity="0.6"
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="{x:Bind ViewModel.DisabledCount, Mode=OneWay}" 
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               Foreground="Gray"
                               HorizontalAlignment="Center"
                               FontWeight="Bold"/>
                    <TextBlock Text="Désactivés" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Opacity="0.6"
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <TextBlock Text="{x:Bind ViewModel.HighImpactCount, Mode=OneWay}" 
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               Foreground="OrangeRed"
                               HorizontalAlignment="Center"
                               FontWeight="Bold"/>
                    <TextBlock Text="Impact élevé" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Opacity="0.6"
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                    <TextBlock Text="{x:Bind ViewModel.TotalBootImpact, Mode=OneWay}" 
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               HorizontalAlignment="Center"
                               FontWeight="Bold"/>
                    <TextBlock Text="Impact total" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Opacity="0.6"
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="5" HorizontalAlignment="Center">
                    <TextBlock Text="{x:Bind ViewModel.PotentialSavings, Mode=OneWay}" 
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                               HorizontalAlignment="Center"
                               FontWeight="Bold"/>
                    <TextBlock Text="Économie possible" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Opacity="0.6"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Contenu principal -->
        <Grid Grid.Row="2" Margin="24,8" ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="320"/>
            </Grid.ColumnDefinitions>

            <!-- Liste des programmes -->
            <Border Grid.Column="0"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    CornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/><!-- Recherche et filtres -->
                        <RowDefinition Height="Auto"/><!-- Actions groupées -->
                        <RowDefinition Height="Auto"/><!-- En-têtes de tri -->
                        <RowDefinition Height="*"/><!-- Liste -->
                    </Grid.RowDefinitions>

                    <!-- Barre de recherche et filtres -->
                    <Grid Grid.Row="0" Padding="16,12" ColumnSpacing="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <AutoSuggestBox Grid.Column="0"
                                        PlaceholderText="Rechercher..."
                                        QueryIcon="Find"
                                        Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4">
                            <ToggleButton Content="Registre" 
                                          IsChecked="{x:Bind ViewModel.ShowRegistry, Mode=TwoWay}"
                                          ToolTipService.ToolTip="Afficher les entrées du registre"/>
                            <ToggleButton Content="Dossier" 
                                          IsChecked="{x:Bind ViewModel.ShowStartupFolder, Mode=TwoWay}"
                                          ToolTipService.ToolTip="Afficher les raccourcis du dossier Démarrage"/>
                            <ToggleButton Content="Tâches" 
                                          IsChecked="{x:Bind ViewModel.ShowScheduledTasks, Mode=TwoWay}"
                                          ToolTipService.ToolTip="Afficher les tâches planifiées"/>
                            <ToggleButton Content="Désactivés" 
                                          IsChecked="{x:Bind ViewModel.ShowDisabled, Mode=TwoWay}"
                                          ToolTipService.ToolTip="Afficher les programmes désactivés"/>
                        </StackPanel>
                    </Grid>

                    <!-- Actions groupées -->
                    <Border Grid.Row="1" 
                            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                            Padding="16,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                                <Button Content="✓ Tout" 
                                        Command="{x:Bind ViewModel.SelectAllCommand}"
                                        Padding="8,4"
                                        ToolTipService.ToolTip="Tout sélectionner"/>
                                <Button Content="✗ Rien" 
                                        Command="{x:Bind ViewModel.DeselectAllCommand}"
                                        Padding="8,4"
                                        ToolTipService.ToolTip="Tout désélectionner"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                <Button Command="{x:Bind ViewModel.EnableAllSelectedCommand}"
                                        ToolTipService.ToolTip="Activer la sélection"
                                        Padding="8,4">
                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                        <FontIcon Glyph="&#xE73E;" FontSize="12" Foreground="Green"/>
                                        <TextBlock Text="Activer"/>
                                    </StackPanel>
                                </Button>
                                <Button Command="{x:Bind ViewModel.DisableAllSelectedCommand}"
                                        ToolTipService.ToolTip="Désactiver la sélection"
                                        Padding="8,4">
                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                        <FontIcon Glyph="&#xE738;" FontSize="12" Foreground="Gray"/>
                                        <TextBlock Text="Désactiver"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- En-têtes de colonnes avec tri -->
                    <Border Grid.Row="2" 
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                            BorderThickness="0,0,0,1"
                            Padding="8,0">
                        <Grid Padding="8,8" ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/><!-- Checkbox -->
                                <ColumnDefinition Width="Auto"/><!-- Status -->
                                <ColumnDefinition Width="*"/><!-- Nom -->
                                <ColumnDefinition Width="Auto"/><!-- Type -->
                                <ColumnDefinition Width="80"/><!-- Impact -->
                            </Grid.ColumnDefinitions>

                            <!-- Espace pour checkbox -->
                            <TextBlock Grid.Column="0" Width="32"/>

                            <!-- Tri par statut -->
                            <Button Grid.Column="1"
                                    Command="{x:Bind ViewModel.SortByStatusCommand}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="4,2"
                                    ToolTipService.ToolTip="Trier par état">
                                <StackPanel Orientation="Horizontal" Spacing="2">
                                    <TextBlock Text="État" FontSize="12" FontWeight="SemiBold" Opacity="0.8"/>
                                    <TextBlock Text="{x:Bind ViewModel.StatusSortIndicator, Mode=OneWay}" FontSize="12"/>
                                </StackPanel>
                            </Button>

                            <!-- Tri par nom -->
                            <Button Grid.Column="2"
                                    Command="{x:Bind ViewModel.SortByNameCommand}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    HorizontalAlignment="Left"
                                    Padding="4,2"
                                    ToolTipService.ToolTip="Trier par nom">
                                <StackPanel Orientation="Horizontal" Spacing="2">
                                    <TextBlock Text="Nom" FontSize="12" FontWeight="SemiBold" Opacity="0.8"/>
                                    <TextBlock Text="{x:Bind ViewModel.NameSortIndicator, Mode=OneWay}" FontSize="12"/>
                                </StackPanel>
                            </Button>

                            <!-- Tri par type -->
                            <Button Grid.Column="3"
                                    Command="{x:Bind ViewModel.SortByTypeCommand}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="4,2"
                                    ToolTipService.ToolTip="Trier par type">
                                <StackPanel Orientation="Horizontal" Spacing="2">
                                    <TextBlock Text="Type" FontSize="12" FontWeight="SemiBold" Opacity="0.8"/>
                                    <TextBlock Text="{x:Bind ViewModel.TypeSortIndicator, Mode=OneWay}" FontSize="12"/>
                                </StackPanel>
                            </Button>

                            <!-- Tri par impact -->
                            <Button Grid.Column="4"
                                    Command="{x:Bind ViewModel.SortByImpactCommand}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    HorizontalAlignment="Right"
                                    Padding="4,2"
                                    ToolTipService.ToolTip="Trier par impact">
                                <StackPanel Orientation="Horizontal" Spacing="2">
                                    <TextBlock Text="Impact" FontSize="12" FontWeight="SemiBold" Opacity="0.8"/>
                                    <TextBlock Text="{x:Bind ViewModel.ImpactSortIndicator, Mode=OneWay}" FontSize="12"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Liste -->
                    <ListView x:Name="StartupListView"
                              Grid.Row="3"
                              ItemsSource="{x:Bind ViewModel.Programs, Mode=OneWay}"
                              SelectionMode="Single"
                              Padding="8">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="models:StartupProgram">
                                <Grid Padding="8,10" ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Checkbox -->
                                    <CheckBox Grid.Column="0"
                                              IsChecked="{x:Bind IsSelected, Mode=TwoWay}"
                                              MinWidth="0"
                                              VerticalAlignment="Center"/>

                                    <!-- Indicateur d'état (remplace ToggleSwitch problématique) -->
                                    <Border Grid.Column="1"
                                            Width="8" Height="8"
                                            CornerRadius="4"
                                            Background="{x:Bind StatusBrush, Mode=OneWay}"
                                            VerticalAlignment="Center"
                                            ToolTipService.ToolTip="{x:Bind StatusText, Mode=OneWay}"/>

                                    <!-- Infos -->
                                    <StackPanel Grid.Column="2" Spacing="2" VerticalAlignment="Center">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <TextBlock Text="{x:Bind Name}" 
                                                       FontWeight="SemiBold"
                                                       TextTrimming="CharacterEllipsis"/>
                                            <FontIcon Glyph="&#xE7BA;" 
                                                      FontSize="12" 
                                                      Foreground="Orange"
                                                      Visibility="{x:Bind FileExistsWarningVisibility}"
                                                      ToolTipService.ToolTip="Fichier introuvable"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <FontIcon Glyph="{x:Bind TypeIcon}" FontSize="10" Opacity="0.5"/>
                                            <TextBlock Text="{x:Bind Publisher}" 
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Opacity="0.6"
                                                       TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Type -->
                                    <Border Grid.Column="3"
                                            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                            CornerRadius="4"
                                            Padding="8,4"
                                            VerticalAlignment="Center">
                                        <TextBlock Text="{x:Bind TypeName}" 
                                                   Style="{StaticResource CaptionTextBlockStyle}"/>
                                    </Border>

                                    <!-- Impact -->
                                    <StackPanel Grid.Column="4" 
                                                Orientation="Horizontal" 
                                                Spacing="4"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center">
                                        <FontIcon Glyph="{x:Bind ImpactIcon}" 
                                                  FontSize="14"
                                                  Foreground="{x:Bind ImpactBrush}"/>
                                        <TextBlock Text="{x:Bind ImpactName}"
                                                   Foreground="{x:Bind ImpactBrush}"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </Border>

            <!-- Panneau de détails -->
            <Border Grid.Column="1"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    CornerRadius="8"
                    Padding="20">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Détails du programme sélectionné -->
                    <ScrollViewer x:Name="DetailsScrollViewer" 
                                  Grid.Row="0" 
                                  Visibility="{x:Bind ViewModel.HasSelection, Mode=OneWay}">
                        <StackPanel Spacing="16">
                            <TextBlock Text="Détails" 
                                       Style="{StaticResource SubtitleTextBlockStyle}"
                                       FontWeight="SemiBold"/>

                            <!-- Nom -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Nom" Opacity="0.6" FontSize="12"/>
                                <TextBlock x:Name="DetailNameText"
                                           TextWrapping="Wrap"
                                           FontWeight="SemiBold"/>
                            </StackPanel>

                            <!-- Éditeur -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Éditeur" Opacity="0.6" FontSize="12"/>
                                <TextBlock x:Name="DetailPublisherText"
                                           TextWrapping="Wrap"/>
                            </StackPanel>

                            <!-- Commande -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Commande" Opacity="0.6" FontSize="12"/>
                                <TextBlock x:Name="DetailCommandText"
                                           TextWrapping="Wrap"
                                           IsTextSelectionEnabled="True"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           FontFamily="Consolas"/>
                            </StackPanel>

                            <!-- Type -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Type" Opacity="0.6" FontSize="12"/>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon x:Name="DetailTypeIcon" FontSize="14"/>
                                    <TextBlock x:Name="DetailTypeText"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Portée -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Portée" Opacity="0.6" FontSize="12"/>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon x:Name="DetailScopeIcon" FontSize="14"/>
                                    <TextBlock x:Name="DetailScopeText"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Impact -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Impact sur le démarrage" Opacity="0.6" FontSize="12"/>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon x:Name="DetailImpactIcon" FontSize="14"/>
                                    <TextBlock x:Name="DetailImpactText" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="DetailImpactMs" Opacity="0.6"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Emplacement -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Emplacement" Opacity="0.6" FontSize="12"/>
                                <TextBlock x:Name="DetailLocationText"
                                           TextWrapping="Wrap"
                                           IsTextSelectionEnabled="True"
                                           Style="{StaticResource CaptionTextBlockStyle}"/>
                            </StackPanel>

                            <!-- Avertissement fichier manquant -->
                            <InfoBar x:Name="FileNotFoundInfoBar"
                                     Title="Fichier introuvable"
                                     Message="L'exécutable spécifié n'existe pas. Ce programme ne pourra pas démarrer."
                                     Severity="Warning"
                                     IsOpen="True"
                                     IsClosable="False"
                                     Visibility="Collapsed"/>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Message quand rien n'est sélectionné -->
                    <StackPanel Grid.Row="0"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Spacing="12"
                                Visibility="{x:Bind ViewModel.HasSelection, Mode=OneWay, Converter={StaticResource BoolToInverseVisibilityConverter}}">
                        <FontIcon Glyph="&#xE8A5;" FontSize="48" Opacity="0.3"/>
                        <TextBlock Text="Sélectionnez un programme"
                                   Style="{StaticResource BodyTextBlockStyle}"
                                   Opacity="0.5"/>
                    </StackPanel>

                    <!-- Actions -->
                    <StackPanel Grid.Row="1" 
                                Spacing="8"
                                Visibility="{x:Bind ViewModel.HasSelection, Mode=OneWay}">
                        <Border Height="1" 
                                Background="{ThemeResource DividerStrokeColorDefaultBrush}"
                                Margin="0,8"/>

                        <Button HorizontalAlignment="Stretch"
                                Command="{x:Bind ViewModel.OpenFileLocationCommand}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8B7;" FontSize="14"/>
                                <TextBlock Text="Ouvrir l'emplacement"/>
                            </StackPanel>
                        </Button>

                        <Button HorizontalAlignment="Stretch"
                                Command="{x:Bind ViewModel.EnableSelectedCommand}"
                                Style="{StaticResource AccentButtonStyle}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE73E;" FontSize="14"/>
                                <TextBlock Text="Activer"/>
                            </StackPanel>
                        </Button>

                        <Button HorizontalAlignment="Stretch"
                                Command="{x:Bind ViewModel.DisableSelectedCommand}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE738;" FontSize="14"/>
                                <TextBlock Text="Désactiver"/>
                            </StackPanel>
                        </Button>

                        <Button HorizontalAlignment="Stretch"
                                Command="{x:Bind ViewModel.RemoveSelectedCommand}"
                                Foreground="{ThemeResource SystemFillColorCriticalBrush}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE74D;" FontSize="14"/>
                                <TextBlock Text="Supprimer du démarrage"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Barre de statut -->
        <Border Grid.Row="3"
                Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                Padding="24,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           VerticalAlignment="Center"/>

                <ProgressBar Grid.Column="1"
                             Value="{x:Bind ViewModel.Progress, Mode=OneWay}"
                             Maximum="100"
                             Width="150"
                             Visibility="{x:Bind ViewModel.IsBusy, Mode=OneWay}"/>
            </Grid>
        </Border>

        <!-- Overlay de chargement -->
        <Grid Grid.RowSpan="4"
              Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}"
              Visibility="{x:Bind ViewModel.IsBusy, Mode=OneWay}">
            <StackPanel HorizontalAlignment="Center" 
                        VerticalAlignment="Center"
                        Spacing="16">
                <ProgressRing IsActive="True" Width="48" Height="48"/>
                <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                           Style="{StaticResource SubtitleTextBlockStyle}"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
