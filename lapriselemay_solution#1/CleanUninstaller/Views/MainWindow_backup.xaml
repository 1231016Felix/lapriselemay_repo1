<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="CleanUninstaller.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:CleanUninstaller.Models"
    xmlns:local="using:CleanUninstaller.Views"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    Title="Clean Uninstaller">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="48" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <Grid x:Name="AppTitleBar" Grid.Row="0" Background="Transparent">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            
            <StackPanel Orientation="Horizontal" Spacing="12" Margin="16,0">
                <FontIcon Glyph="&#xE74D;" FontSize="18" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" />
                <TextBlock Text="Clean Uninstaller" 
                           Style="{StaticResource CaptionTextBlockStyle}"
                           VerticalAlignment="Center" />
                <Border Background="{ThemeResource AccentFillColorDefaultBrush}" 
                        CornerRadius="4" Padding="6,2" VerticalAlignment="Center">
                    <TextBlock Text="v1.0" Style="{StaticResource CaptionTextBlockStyle}" 
                               Foreground="White" FontSize="10" />
                </Border>
            </StackPanel>
        </Grid>

        <!-- Toolbar -->
        <Grid Grid.Row="1" Padding="16,8" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" Spacing="4">
                <Button x:Name="RefreshButton"
                        Click="RefreshButton_Click"
                        ToolTipService.ToolTip="Actualiser la liste (F5)"
                        Style="{StaticResource SubtleButtonStyle}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE72C;" FontSize="14" />
                        <TextBlock Text="Actualiser" />
                    </StackPanel>
                </Button>

                <AppBarSeparator />

                <Button x:Name="UninstallButton"
                        Click="UninstallButton_Click"
                        Style="{StaticResource AccentButtonStyle}"
                        ToolTipService.ToolTip="Désinstaller le programme sélectionné">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74D;" FontSize="14" />
                        <TextBlock Text="Désinstaller" />
                    </StackPanel>
                </Button>

                <DropDownButton x:Name="UninstallOptionsButton" ToolTipService.ToolTip="Options de désinstallation">
                    <FontIcon Glyph="&#xE712;" FontSize="12" />
                    <DropDownButton.Flyout>
                        <MenuFlyout Placement="Bottom">
                            <MenuFlyoutItem Text="Désinstallation standard" Icon="Delete" Click="UninstallStandard_Click" />
                            <MenuFlyoutItem Text="Désinstallation silencieuse" Click="UninstallSilent_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE74F;" />
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutSeparator />
                            <MenuFlyoutItem Text="Désinstallation forcée" Click="UninstallForced_Click"
                                            Foreground="{ThemeResource SystemFillColorCriticalBrush}">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE7BA;" Foreground="{ThemeResource SystemFillColorCriticalBrush}" />
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutSeparator />
                            <MenuFlyoutItem Text="Désinstaller la sélection" Click="UninstallBatch_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE762;" />
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </DropDownButton.Flyout>
                </DropDownButton>

                <AppBarSeparator />

                <Button x:Name="ExportButton" Click="ExportButton_Click"
                        ToolTipService.ToolTip="Exporter la liste des programmes"
                        Style="{StaticResource SubtleButtonStyle}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xEDE1;" FontSize="14" />
                        <TextBlock Text="Exporter" />
                    </StackPanel>
                </Button>
            </StackPanel>

            <AutoSuggestBox x:Name="SearchBox"
                            Grid.Column="1" 
                            PlaceholderText="Rechercher un programme..."
                            QueryIcon="Find"
                            TextChanged="SearchBox_TextChanged"
                            MaxWidth="400"
                            Margin="16,0" />

            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4">
                <DropDownButton Content="Trier" Style="{StaticResource SubtleButtonStyle}">
                    <DropDownButton.Flyout>
                        <MenuFlyout>
                            <RadioMenuFlyoutItem x:Name="SortByNameItem" Text="Nom" IsChecked="True" Click="SortByName_Click" />
                            <RadioMenuFlyoutItem x:Name="SortByPublisherItem" Text="Éditeur" Click="SortByPublisher_Click" />
                            <RadioMenuFlyoutItem x:Name="SortBySizeItem" Text="Taille" Click="SortBySize_Click" />
                            <RadioMenuFlyoutItem x:Name="SortByDateItem" Text="Date d'installation" Click="SortByDate_Click" />
                            <MenuFlyoutSeparator />
                            <ToggleMenuFlyoutItem x:Name="SortDescendingItem" Text="Ordre décroissant" Click="SortOrder_Click" />
                        </MenuFlyout>
                    </DropDownButton.Flyout>
                </DropDownButton>

                <DropDownButton Content="Filtres" Style="{StaticResource SubtleButtonStyle}">
                    <DropDownButton.Flyout>
                        <MenuFlyout>
                            <ToggleMenuFlyoutItem x:Name="ShowSystemAppsToggle" 
                                                  Text="Applications système"
                                                  Click="FilterChanged_Click" />
                            <ToggleMenuFlyoutItem x:Name="ShowWindowsAppsToggle" 
                                                  Text="Applications Windows Store"
                                                  IsChecked="True"
                                                  Click="FilterChanged_Click" />
                            <MenuFlyoutSeparator />
                            <MenuFlyoutSubItem Text="Filtrer par taille">
                                <RadioMenuFlyoutItem x:Name="SizeFilterAllItem" 
                                                     Text="Toutes les tailles" 
                                                     IsChecked="True"
                                                     Click="SizeFilter_Click" Tag="All" />
                                <MenuFlyoutSeparator />
                                <RadioMenuFlyoutItem x:Name="SizeFilterSmallItem" 
                                                     Text="Petit (&lt; 10 Mo)" 
                                                     Click="SizeFilter_Click" Tag="Small" />
                                <RadioMenuFlyoutItem x:Name="SizeFilterMediumItem" 
                                                     Text="Moyen (10 - 100 Mo)" 
                                                     Click="SizeFilter_Click" Tag="Medium" />
                                <RadioMenuFlyoutItem x:Name="SizeFilterLargeItem" 
                                                     Text="Grand (100 Mo - 1 Go)" 
                                                     Click="SizeFilter_Click" Tag="Large" />
                                <RadioMenuFlyoutItem x:Name="SizeFilterVeryLargeItem" 
                                                     Text="Très grand (&gt; 1 Go)" 
                                                     Click="SizeFilter_Click" Tag="VeryLarge" />
                                <MenuFlyoutSeparator />
                                <RadioMenuFlyoutItem x:Name="SizeFilterUnknownItem" 
                                                     Text="Taille inconnue" 
                                                     Click="SizeFilter_Click" Tag="Unknown" />
                            </MenuFlyoutSubItem>
                            <MenuFlyoutSeparator />
                            <MenuFlyoutItem Text="Réinitialiser les filtres" Click="ResetFilters_Click" />
                        </MenuFlyout>
                    </DropDownButton.Flyout>
                </DropDownButton>

                <AppBarSeparator />

                <Button x:Name="SettingsButton" Click="SettingsButton_Click"
                        ToolTipService.ToolTip="Paramètres"
                        Style="{StaticResource SubtleButtonStyle}">
                    <FontIcon Glyph="&#xE713;" FontSize="16" />
                </Button>
            </StackPanel>
        </Grid>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="ProgramListColumn" Width="*" MinWidth="450" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition x:Name="DetailsPanelColumn" Width="380" MinWidth="280" MaxWidth="600" />
            </Grid.ColumnDefinitions>

            <!-- Program List -->
            <Grid Padding="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- InfoBar pour les messages -->
                <InfoBar x:Name="MainInfoBar" 
                         IsOpen="False" 
                         Severity="Informational"
                         Margin="0,0,0,8" />

                <Grid Grid.Row="1" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <CheckBox x:Name="SelectAllCheckbox" 
                              Content="Tout sélectionner"
                              Click="SelectAllCheckbox_Click" />

                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="16">
                        <TextBlock x:Name="SelectionInfoText"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                   VerticalAlignment="Center"
                                   Visibility="Collapsed" />
                        <TextBlock x:Name="ProgramCountText"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   VerticalAlignment="Center"
                                   Text="0 programmes" />
                    </StackPanel>
                </Grid>

                <!-- En-tête de colonnes -->
                <Grid Grid.Row="2" Margin="8,0,8,4" Padding="8,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" MinWidth="150" />
                        <ColumnDefinition Width="140" />
                        <ColumnDefinition Width="100" />
                        <ColumnDefinition Width="90" />
                    </Grid.ColumnDefinitions>
                    
                    <!-- Espace pour checkbox -->
                    <Border Width="32" />
                    
                    <!-- Espace pour icône -->
                    <Border Grid.Column="1" Width="48" />
                    
                    <!-- Nom -->
                    <Button Grid.Column="2" 
                            Style="{StaticResource SubtleButtonStyle}"
                            HorizontalAlignment="Left"
                            Padding="4,2"
                            Click="SortByNameHeader_Click"
                            ToolTipService.ToolTip="Trier par nom">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock Text="Nom" 
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <FontIcon x:Name="SortNameIcon" 
                                      Glyph="&#xE70D;" 
                                      FontSize="10" 
                                      Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                      Visibility="Visible" />
                        </StackPanel>
                    </Button>
                    
                    <!-- Éditeur -->
                    <Button Grid.Column="3" 
                            Style="{StaticResource SubtleButtonStyle}"
                            HorizontalAlignment="Left"
                            Padding="4,2"
                            Click="SortByPublisherHeader_Click"
                            ToolTipService.ToolTip="Trier par éditeur">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock Text="Éditeur" 
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <FontIcon x:Name="SortPublisherIcon" 
                                      Glyph="&#xE70D;" 
                                      FontSize="10" 
                                      Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                      Visibility="Collapsed" />
                        </StackPanel>
                    </Button>
                    
                    <!-- Date d'installation -->
                    <Button Grid.Column="4" 
                            Style="{StaticResource SubtleButtonStyle}"
                            HorizontalAlignment="Left"
                            Padding="4,2"
                            Click="SortByDateHeader_Click"
                            ToolTipService.ToolTip="Trier par date d'installation">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock Text="Installé le" 
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <FontIcon x:Name="SortDateIcon" 
                                      Glyph="&#xE70D;" 
                                      FontSize="10" 
                                      Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                      Visibility="Collapsed" />
                        </StackPanel>
                    </Button>
                    
                    <!-- Taille (cliquable pour trier) -->
                    <Button x:Name="SizeColumnHeader"
                            Grid.Column="5" 
                            Style="{StaticResource SubtleButtonStyle}"
                            HorizontalAlignment="Right"
                            Padding="4,2"
                            Click="SortBySizeHeader_Click"
                            ToolTipService.ToolTip="Trier par taille">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock Text="Taille" 
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <FontIcon x:Name="SortSizeIcon" 
                                      Glyph="&#xE70D;" 
                                      FontSize="10" 
                                      Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                      Visibility="Collapsed" />
                        </StackPanel>
                    </Button>
                </Grid>

                <ListView x:Name="ProgramListView"
                          Grid.Row="3"
                          SelectionMode="Single"
                          SelectionChanged="ProgramListView_SelectionChanged"
                          DoubleTapped="ProgramListView_DoubleTapped">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:InstalledProgram">
                            <Grid Padding="8,10" ColumnSpacing="12"
                                  ToolTipService.ToolTip="{x:Bind InstallerType}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" MinWidth="150" />
                                    <ColumnDefinition Width="140" />
                                    <ColumnDefinition Width="100" />
                                    <ColumnDefinition Width="90" />
                                </Grid.ColumnDefinitions>

                                <CheckBox IsChecked="{x:Bind IsSelected, Mode=TwoWay}"
                                          VerticalAlignment="Center"
                                          MinWidth="0" />

                                <!-- Icône du programme -->
                                <Grid Grid.Column="1" Width="36" Height="36" VerticalAlignment="Center">
                                    <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                            CornerRadius="6"
                                            Visibility="{x:Bind IconPlaceholderVisibility, Mode=OneWay}">
                                        <FontIcon Glyph="&#xE74C;" 
                                                  FontSize="18"
                                                  Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                    </Border>
                                    <Image Source="{x:Bind Icon, Mode=OneWay}" 
                                           Width="32" Height="32"
                                           Stretch="Uniform"
                                           Visibility="{x:Bind IconVisibility, Mode=OneWay}" />
                                </Grid>

                                <!-- Nom et badges -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center" Spacing="2">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="{x:Bind DisplayName}" 
                                                   FontWeight="SemiBold"
                                                   TextTrimming="CharacterEllipsis" />
                                        <!-- Badge Windows App -->
                                        <Border Visibility="{x:Bind IsWindowsApp}"
                                                Background="{ThemeResource AccentFillColorDefaultBrush}"
                                                CornerRadius="4" Padding="6,2">
                                            <TextBlock Text="Store" FontSize="10" Foreground="White" />
                                        </Border>
                                        <!-- Badge Système -->
                                        <Border Visibility="{x:Bind IsSystemComponent}"
                                                Background="{ThemeResource SystemFillColorCautionBrush}"
                                                CornerRadius="4" Padding="6,2">
                                            <TextBlock Text="Système" FontSize="10" />
                                        </Border>
                                    </StackPanel>
                                    <TextBlock Text="{x:Bind Version}" 
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                                </StackPanel>

                                <!-- Éditeur -->
                                <TextBlock Grid.Column="3" 
                                           Text="{x:Bind Publisher}" 
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           TextTrimming="CharacterEllipsis"
                                           VerticalAlignment="Center"
                                           ToolTipService.ToolTip="{x:Bind Publisher}" />

                                <!-- Date d'installation -->
                                <TextBlock Grid.Column="4" 
                                           Text="{x:Bind FormattedInstallDate}" 
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           VerticalAlignment="Center" />

                                <!-- Taille -->
                                <Border Grid.Column="5" 
                                        Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="4"
                                        Padding="10,4"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Right">
                                    <TextBlock Text="{x:Bind FormattedSize}" 
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               FontFamily="Consolas" />
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- Loading overlay avec fond flou -->
                <Grid x:Name="LoadingOverlay" 
                      Grid.Row="3" 
                      Visibility="Collapsed">
                    <!-- Fond semi-transparent avec effet de flou -->
                    <Border Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}" 
                            Opacity="0.95" />
                    
                    <!-- Panneau de chargement avec fond solide pour lisibilité -->
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            CornerRadius="12"
                            Padding="32"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            MinWidth="320">
                        <Border.Shadow>
                            <ThemeShadow />
                        </Border.Shadow>
                        <StackPanel Spacing="16">
                            <ProgressRing IsActive="True" Width="48" Height="48" />
                            <TextBlock x:Name="LoadingStatusText"
                                       Text="Chargement..."
                                       Style="{StaticResource SubtitleTextBlockStyle}"
                                       TextAlignment="Center" />
                            <ProgressBar x:Name="LoadingProgressBar"
                                         Value="0"
                                         Maximum="100"
                                         Width="250" />
                            <Button x:Name="CancelLoadingButton" 
                                    Content="Annuler" 
                                    Click="CancelLoading_Click"
                                    HorizontalAlignment="Center" />
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>

            <!-- GridSplitter pour redimensionner les panneaux -->
            <controls:GridSplitter Grid.Column="1" 
                                   Width="8"
                                   ResizeBehavior="BasedOnAlignment"
                                   ResizeDirection="Columns"
                                   Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

            <!-- Details Panel -->
            <Grid Grid.Column="2" Padding="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Program Details -->
                <StackPanel x:Name="DetailsPanel" Visibility="Collapsed">
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        
                        <Grid Width="48" Height="48" Margin="0,0,12,0">
                            <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                    CornerRadius="8">
                                <FontIcon x:Name="DetailIconPlaceholder" Glyph="&#xE74C;" FontSize="24"
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            </Border>
                            <Image x:Name="DetailIcon" Width="44" Height="44" Stretch="Uniform" />
                        </Grid>
                        
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock x:Name="DetailNameText"
                                       FontWeight="SemiBold"
                                       FontSize="16"
                                       TextWrapping="Wrap"
                                       MaxLines="2" />
                            <TextBlock x:Name="DetailPublisherText"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        </StackPanel>
                    </Grid>
                    
                    <!-- Informations détaillées -->
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            CornerRadius="8" Padding="12" Margin="0,0,0,12">
                        <StackPanel Spacing="8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Version" Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                                <TextBlock x:Name="DetailVersionText" Grid.Column="1" 
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                            </Grid>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Installé le" Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                                <TextBlock x:Name="DetailDateText" Grid.Column="1"
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                            </Grid>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Taille" Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                                <TextBlock x:Name="DetailSizeText" Grid.Column="1"
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                            </Grid>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Type" Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                                <TextBlock x:Name="DetailTypeText" Grid.Column="1"
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Emplacement -->
                    <Expander Header="Emplacement" HorizontalAlignment="Stretch" Margin="0,0,0,12">
                        <StackPanel Spacing="8" Padding="4">
                            <TextBlock x:Name="DetailLocationText"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       TextWrapping="Wrap"
                                       IsTextSelectionEnabled="True" />
                            <Button x:Name="OpenLocationButton" 
                                    Content="Ouvrir le dossier"
                                    Click="OpenLocationButton_Click"
                                    HorizontalAlignment="Left" />
                        </StackPanel>
                    </Expander>

                    <!-- Actions -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Content="Analyser les résidus..."
                                Click="ScanResidualsButton_Click"
                                ToolTipService.ToolTip="Ouvre une fenêtre pour analyser et supprimer les résidus"
                                Style="{StaticResource AccentButtonStyle}" />
                        <Button x:Name="ModifyButton"
                                Content="Modifier"
                                Click="ModifyButton_Click"
                                Visibility="Collapsed" />
                    </StackPanel>
                </StackPanel>

                <!-- Placeholder -->
                <StackPanel x:Name="PlaceholderPanel"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Spacing="8">
                    <FontIcon Glyph="&#xE8A5;" FontSize="48" 
                              Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                    <TextBlock Text="Sélectionnez un programme"
                               Style="{StaticResource BodyTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               TextAlignment="Center" />
                    <TextBlock Text="pour voir ses détails"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                               TextAlignment="Center" />
                </StackPanel>

                <!-- Residuals List -->
                <Grid x:Name="ResidualsPanel" 
                      Grid.Row="1" 
                      Margin="0,16,0,0"
                      Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Résidus trouvés" Style="{StaticResource SubtitleTextBlockStyle}" />
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4">
                            <Button ToolTipService.ToolTip="Sélectionner confiance élevée" 
                                    Click="SelectHighConfidence_Click"
                                    Style="{StaticResource SubtleButtonStyle}" Padding="6">
                                <FontIcon Glyph="&#xE8FB;" FontSize="14" />
                            </Button>
                            <Button ToolTipService.ToolTip="Tout sélectionner/désélectionner"
                                    Click="ToggleSelectAllResiduals_Click"
                                    Style="{StaticResource SubtleButtonStyle}" Padding="6">
                                <FontIcon Glyph="&#xE762;" FontSize="14" />
                            </Button>
                        </StackPanel>
                    </Grid>

                    <!-- Légende confiance -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="12" Margin="0,0,0,8">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <Ellipse Width="8" Height="8" Fill="#107C10" />
                            <TextBlock Text="Très haute" Style="{StaticResource CaptionTextBlockStyle}" 
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <Ellipse Width="8" Height="8" Fill="#498205" />
                            <TextBlock Text="Haute" Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <Ellipse Width="8" Height="8" Fill="#CA5010" />
                            <TextBlock Text="Moyenne" Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        </StackPanel>
                    </StackPanel>

                    <ListView x:Name="ResidualsListView" Grid.Row="2" SelectionMode="None">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="Padding" Value="0" />
                                <Setter Property="Margin" Value="0,1" />
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="models:ResidualItem">
                                <Grid Padding="4,6" ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <CheckBox IsChecked="{x:Bind IsSelected, Mode=TwoWay}" MinWidth="20" VerticalAlignment="Center" />

                                    <!-- Indicateur de confiance avec convertisseur -->
                                    <Border Grid.Column="1" 
                                            Width="4" 
                                            CornerRadius="2"
                                            VerticalAlignment="Stretch"
                                            Background="{x:Bind ConfidenceBrush}" />

                                    <StackPanel Grid.Column="2" Spacing="2" VerticalAlignment="Center" Margin="4,0,0,0">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <FontIcon Glyph="{x:Bind TypeIcon}" FontSize="12"
                                                      Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                            <TextBlock Text="{x:Bind DisplayPath}"
                                                       TextTrimming="CharacterEllipsis"
                                                       ToolTipService.ToolTip="{x:Bind Path}"
                                                       Style="{StaticResource CaptionTextBlockStyle}" />
                                        </StackPanel>
                                        <TextBlock Text="{x:Bind TypeName}"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                                   FontSize="11" />
                                    </StackPanel>

                                    <TextBlock Grid.Column="3"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Text="{x:Bind FormattedSize}"
                                               VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>

                <!-- Cleanup Actions -->
                <Border x:Name="CleanupActionsPanel" 
                        Grid.Row="2"
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        CornerRadius="8"
                        Padding="12"
                        Margin="0,12,0,0"
                        Visibility="Collapsed">
                    <StackPanel Spacing="12">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock x:Name="ResidualsCountText"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       VerticalAlignment="Center" />
                            <TextBlock x:Name="ResidualsSizeText" Grid.Column="1"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center" />
                        </Grid>

                        <Button Content="Nettoyer les résidus sélectionnés"
                                Click="CleanupResidualsButton_Click"
                                Style="{StaticResource AccentButtonStyle}"
                                HorizontalAlignment="Stretch" />
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Grid Grid.Row="3" 
              Padding="16,10"
              Background="{ThemeResource LayerFillColorDefaultBrush}"
              BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
              BorderThickness="0,1,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock x:Name="StatusText"
                       Text="Prêt"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       VerticalAlignment="Center" />

            <TextBlock x:Name="TotalSizeText"
                       Grid.Column="1"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       VerticalAlignment="Center"
                       Margin="0,0,16,0" />

            <ProgressBar x:Name="StatusProgressBar"
                         Grid.Column="2"
                         Value="0"
                         Maximum="100"
                         Width="150"
                         Visibility="Collapsed" />
        </Grid>

        <!-- Uninstall Overlay -->
        <Grid x:Name="UninstallOverlay"
              Grid.RowSpan="4"
              Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}"
              Visibility="Collapsed">
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    CornerRadius="12"
                    Padding="32"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    MinWidth="400">
                <StackPanel Spacing="20">
                    <ProgressRing x:Name="UninstallProgressRing" IsActive="True" Width="56" Height="56" />
                    <TextBlock x:Name="UninstallStatusText"
                               Text="Désinstallation en cours..."
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               TextAlignment="Center" />
                    <ProgressBar x:Name="UninstallProgressBar"
                                 Value="0"
                                 Maximum="100" />
                    <TextBlock x:Name="UninstallDetailText"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               TextAlignment="Center"
                               TextWrapping="Wrap" />
                    <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center">
                        <Button x:Name="ContinueUninstallButton"
                                Content="Continuer manuellement"
                                Click="ContinueUninstall_Click"
                                Visibility="Collapsed"
                                ToolTipService.ToolTip="Cliquez si le désinstalleur est terminé mais l'application ne le détecte pas" />
                        <Button x:Name="CancelUninstallButton"
                                Content="Annuler"
                                Click="CancelUninstall_Click" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
