<Window x:Class="TempCleaner.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:TempCleaner.ViewModels"
        xmlns:converters="clr-namespace:TempCleaner.Converters"
        Title="TempCleaner - Nettoyeur intelligent" 
        Height="750" Width="1100"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}">
    
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <converters:FileSizeConverter x:Key="FileSizeConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVis"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVis"/>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="ðŸ§¹ TempCleaner" FontSize="28" FontWeight="SemiBold" 
                       Foreground="{StaticResource TextPrimaryBrush}"/>
            <TextBlock Text="Nettoyeur de fichiers temporaires intelligent" 
                       FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0"/>
        </StackPanel>

        <!-- Profils de nettoyage -->
        <Border Grid.Row="1" Style="{StaticResource CardStyle}" Margin="0,0,0,16">
            <StackPanel>
                <TextBlock Text="ðŸ“‹ CatÃ©gories Ã  analyser" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                <ItemsControl ItemsSource="{Binding Profiles}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="0,0,8,8" Padding="12,8" CornerRadius="6"
                                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                                    Background="{StaticResource SurfaceBrush}">
                                <StackPanel Orientation="Horizontal">
                                    <CheckBox IsChecked="{Binding IsEnabled}" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding Icon}" FontSize="16" Margin="8,0,6,0" VerticalAlignment="Center"/>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Name}" FontWeight="Medium"/>
                                        <TextBlock FontSize="11" Foreground="{StaticResource TextSecondaryBrush}">
                                            <Run Text="{Binding FileCount, Mode=OneWay}"/> fichiers - 
                                            <Run Text="{Binding TotalSizeFormatted, Mode=OneWay}"/>
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </Border>

        <!-- Liste des fichiers avec filtres -->
        <Border Grid.Row="2" Style="{StaticResource CardStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Barre de filtres -->
                <Grid Grid.Row="0" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0" Style="{StaticResource SearchTextBox}"
                             Text="{Binding SearchFilter, UpdateSourceTrigger=PropertyChanged}"
                             Tag="ðŸ” Rechercher un fichier..."/>

                    <ComboBox Grid.Column="1" Width="200" Margin="12,0,0,0"
                              ItemsSource="{Binding Profiles}"
                              SelectedItem="{Binding SelectedCategory}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Icon}" Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding Name}"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <Button Grid.Column="2" Content="âœ“ Tout" Style="{StaticResource SecondaryButton}" 
                            Command="{Binding SelectAllCommand}" Margin="12,0,0,0"/>
                    <Button Grid.Column="3" Content="âœ— Aucun" Style="{StaticResource SecondaryButton}" 
                            Command="{Binding DeselectAllCommand}" Margin="8,0,0,0"/>
                    <Button Grid.Column="4" Content="â†” Inverser" Style="{StaticResource SecondaryButton}" 
                            Command="{Binding InvertSelectionCommand}" Margin="8,0,0,0"/>
                </Grid>

                <!-- Liste des fichiers -->
                <DataGrid Grid.Row="1" 
                          x:Name="FilesDataGrid"
                          ItemsSource="{Binding FilteredFiles}"
                          AutoGenerateColumns="False"
                          IsReadOnly="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="Column"
                          BorderThickness="0"
                          Background="Transparent"
                          RowBackground="{StaticResource SurfaceBrush}"
                          AlternatingRowBackground="#FAFAFA"
                          SelectionMode="Extended"
                          SelectionUnit="FullRow">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="âœ“" Width="50">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                              HorizontalAlignment="Center" VerticalAlignment="Center"
                                              Checked="CheckBox_Changed" Unchecked="CheckBox_Changed"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Nom" Binding="{Binding FileName}" Width="*" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Taille" Binding="{Binding SizeFormatted}" Width="100" IsReadOnly="True"/>
                        <DataGridTextColumn Header="CatÃ©gorie" Binding="{Binding Category}" Width="180" IsReadOnly="True"/>
                        <DataGridTextColumn Header="ModifiÃ©" Binding="{Binding LastModified, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" Width="140" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Chemin" Binding="{Binding RelativePath}" Width="250" IsReadOnly="True"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Message si aucun fichier -->
                <Border Grid.Row="1" 
                        Visibility="{Binding FilteredFiles.Count, Converter={StaticResource InverseBoolToVis}}"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="ðŸ“‚" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                        <TextBlock Text="Cliquez sur 'Analyser' pour rechercher les fichiers temporaires"
                                   HorizontalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="14"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Barre de progression -->
        <Grid Grid.Row="3" Margin="0,16,0,0"
              Visibility="{Binding IsWorking, Converter={StaticResource BoolToVis}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <ProgressBar Grid.Column="0" Value="{Binding ProgressPercent}" 
                         Style="{StaticResource ModernProgressBar}" Height="8"/>
            <TextBlock Grid.Column="1" Text="{Binding StatusMessage}" 
                       Margin="12,0,0,0" VerticalAlignment="Center"
                       Foreground="{StaticResource TextSecondaryBrush}"/>
        </Grid>

        <!-- Footer avec stats et boutons -->
        <Grid Grid.Row="4" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Stats -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                <Border Background="#E3F2FD" Padding="12,8" CornerRadius="6" Margin="0,0,12,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“Š Total:" FontWeight="Medium" Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding TotalCount}" FontWeight="Bold" Foreground="{StaticResource AccentBrush}"/>
                        <TextBlock Text=" fichiers (" Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock Text="{Binding TotalSizeFormatted}" FontWeight="Medium" Foreground="{StaticResource AccentBrush}"/>
                        <TextBlock Text=")" Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                </Border>
                <Border Background="#E8F5E9" Padding="12,8" CornerRadius="6">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âœ“ SÃ©lection:" FontWeight="Medium" Margin="0,0,8,0" Foreground="#2E7D32"/>
                        <TextBlock Text="{Binding SelectedCount}" FontWeight="Bold" Foreground="#2E7D32"/>
                        <TextBlock Text=" fichiers (" Foreground="#5C5C5C"/>
                        <TextBlock Text="{Binding SelectedSizeFormatted}" FontWeight="Medium" Foreground="#2E7D32"/>
                        <TextBlock Text=")" Foreground="#5C5C5C"/>
                    </StackPanel>
                </Border>
                <TextBlock Text="{Binding ScanDuration}" Margin="16,0,0,0" 
                           VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}"/>
            </StackPanel>

            <!-- Boutons d'action -->
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="ðŸ” Analyser" Style="{StaticResource ModernButton}"
                        Command="{Binding ScanCommand}" Width="140" Margin="0,0,12,0"/>
                <Button Content="ðŸ—‘ï¸ Nettoyer" Style="{StaticResource DangerButton}"
                        Command="{Binding CleanCommand}" Width="140" Margin="0,0,12,0"/>
                <Button Content="âŒ Annuler" Style="{StaticResource SecondaryButton}"
                        Command="{Binding CancelCommand}" Width="100"
                        Visibility="{Binding CanCancel, Converter={StaticResource BoolToVis}}"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
