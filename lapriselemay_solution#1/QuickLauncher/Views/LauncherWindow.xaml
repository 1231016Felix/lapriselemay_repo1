<Window x:Class="QuickLauncher.Views.LauncherWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:QuickLauncher.ViewModels"
        xmlns:models="clr-namespace:QuickLauncher.Models"
        xmlns:converters="clr-namespace:QuickLauncher.Converters"
        Title="QuickLauncher"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ShowInTaskbar="False"
        Topmost="True"
        WindowStartupLocation="Manual"
        Width="900"
        SizeToContent="Height"
        MaxHeight="600"
        ResizeMode="NoResize"
        Deactivated="Window_Deactivated"
        PreviewKeyDown="Window_PreviewKeyDown"
        Loaded="Window_Loaded">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <converters:IconToVisibilityConverter x:Key="IconToVis"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVis"/>
        <converters:ResultTypeToMenuVisibilityConverter x:Key="TypeToMenuVis"/>
        <converters:NullToVisibilityConverter x:Key="NullToVis"/>
        <converters:PreviewTypeToVisibilityConverter x:Key="PreviewTypeToVis"/>
        
        <!-- Style bouton clear discret -->
        <Style x:Key="ClearButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#555"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="ToolTip" Value="Effacer la recherche"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="#AAA"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Style bouton settings discret -->
        <Style x:Key="SettingsButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="ToolTip" Value="ParamÃ¨tres (Ctrl+,)"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="#AAA"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Style bouton preview toggle -->
        <Style x:Key="PreviewToggleStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="ToolTip" Value="Basculer la prÃ©visualisation (Ctrl+P)"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="#AAA"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Style menu contextuel avec thÃ¨me -->
        <Style x:Key="DarkContextMenuStyle" TargetType="ContextMenu">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="Padding" Value="2"/>
        </Style>
        
        <Style x:Key="DarkMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="{DynamicResource HoverBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Style pour les actions secondaires -->
        <Style x:Key="ActionItemStyle" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource HoverBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Menu contextuel pour les rÃ©sultats -->
        <ContextMenu x:Key="ResultContextMenu" Style="{StaticResource DarkContextMenuStyle}">
            <MenuItem Header="ðŸ“‚ Ouvrir l'emplacement" 
                      Click="ContextMenu_OpenLocation"
                      Style="{StaticResource DarkMenuItemStyle}"
                      InputGestureText="Ctrl+O"
                      Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=FileActions}"/>
            <MenuItem Header="ðŸ“‹ Copier le chemin" 
                      Click="ContextMenu_CopyPath"
                      Style="{StaticResource DarkMenuItemStyle}"
                      InputGestureText="Ctrl+Shift+C"
                      Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=FileActions}"/>
            <MenuItem Header="ðŸ“ Copier le nom" 
                      Click="ContextMenu_CopyName"
                      Style="{StaticResource DarkMenuItemStyle}"
                      Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=FileActions}"/>
            <Separator Background="#3E3E3E" 
                       Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=FileActions}"/>
            <MenuItem Header="ðŸ›¡ï¸ ExÃ©cuter en tant qu'admin" 
                      Click="ContextMenu_RunAsAdmin"
                      Style="{StaticResource DarkMenuItemStyle}"
                      InputGestureText="Ctrl+Enter"
                      Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=RunAsAdmin}"/>
            <MenuItem Header="ðŸ“Ž Ouvrir avec..." 
                      Click="ContextMenu_OpenWith"
                      Style="{StaticResource DarkMenuItemStyle}"
                      Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=OpenWith}"/>
            <MenuItem Header="ðŸ•¶ï¸ Ouvrir en navigation privÃ©e" 
                      Click="ContextMenu_OpenPrivate"
                      Style="{StaticResource DarkMenuItemStyle}"
                      InputGestureText="Ctrl+Shift+Enter"
                      Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=Bookmark}"/>
            <Separator Background="#3E3E3E" 
                       Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=Terminal}"/>
            <MenuItem Header="ðŸ’» Terminal ici" 
                      Click="ContextMenu_OpenTerminal"
                      Style="{StaticResource DarkMenuItemStyle}"
                      InputGestureText="Ctrl+T"
                      Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=Terminal}"/>
            <Separator Background="#3E3E3E" 
                       Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=FileActions}"/>
            <MenuItem Header="âœï¸ Renommer..." 
                      Click="ContextMenu_Rename"
                      Style="{StaticResource DarkMenuItemStyle}"
                      InputGestureText="F2"
                      Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=FileActions}"/>
            <MenuItem Header="ðŸ—‘ï¸ Supprimer" 
                      Click="ContextMenu_Delete"
                      Style="{StaticResource DarkMenuItemStyle}"
                      Foreground="#FF6B6B"
                      InputGestureText="Del"
                      Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=FileActions}"/>
        </ContextMenu>
    </Window.Resources>
    
    <Border Background="{DynamicResource BackgroundBrush}" 
            CornerRadius="12" 
            BorderBrush="{DynamicResource BorderBrush}" 
            BorderThickness="1"
            Margin="20">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" 
                              ShadowDepth="0" 
                              Opacity="0.6" 
                              Color="Black"/>
        </Border.Effect>
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Barre de recherche -->
            <Border Grid.Row="0" 
                    Background="{DynamicResource SurfaceBrush}" 
                    CornerRadius="12,12,0,0"
                    Padding="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- IcÃ´ne recherche / indicateur de chargement -->
                    <TextBlock Grid.Column="0"
                               FontSize="20"
                               VerticalAlignment="Center"
                               Margin="0,0,12,0">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="ðŸ”"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSearching}" Value="True">
                                        <Setter Property="Text" Value="â³"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    
                    <TextBox x:Name="SearchBox"
                             Grid.Column="1"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             FontSize="18"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             Background="Transparent"
                             BorderThickness="0"
                             CaretBrush="{DynamicResource TextPrimaryBrush}"
                             VerticalAlignment="Center"/>
                    
                    <!-- Bouton Clear -->
                    <Button x:Name="ClearButton"
                            Grid.Column="2"
                            Content="âœ•"
                            Style="{StaticResource ClearButtonStyle}"
                            Click="ClearButton_Click"
                            Visibility="Collapsed"/>
                    
                    <!-- Bouton Preview Toggle -->
                    <Button x:Name="PreviewToggleButton"
                            Grid.Column="3"
                            Content="ðŸ‘"
                            Style="{StaticResource PreviewToggleStyle}"
                            Click="PreviewToggle_Click"/>
                    
                    <!-- Bouton Settings discret -->
                    <Button x:Name="SettingsButton"
                            Grid.Column="4"
                            Content="âš™ï¸"
                            Style="{StaticResource SettingsButtonStyle}"
                            Click="SettingsButton_Click"
                            Visibility="{Binding ShowSettingsButton, FallbackValue=Visible}"/>
                </Grid>
            </Border>
            
            <!-- Zone principale: RÃ©sultats + PrÃ©visualisation -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Liste des rÃ©sultats -->
                <ListBox x:Name="ResultsList"
                         Grid.Column="0"
                         ItemsSource="{Binding Results}"
                         SelectedIndex="{Binding SelectedIndex, Mode=TwoWay}"
                         Background="Transparent"
                         BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         VirtualizingPanel.IsVirtualizing="True"
                         MouseDoubleClick="ResultsList_MouseDoubleClick"
                         Visibility="{Binding HasResults, Converter={StaticResource BoolToVis}}">
                    
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="12,10"/>
                            <Setter Property="Margin" Value="4,2"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            <Setter Property="ContextMenu" Value="{StaticResource ResultContextMenu}"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border x:Name="Bd"
                                                Background="{TemplateBinding Background}"
                                                CornerRadius="8"
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource AccentBrush}"/>
                                            </Trigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource HoverBrush}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:SearchResult}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- IcÃ´ne native (si disponible) -->
                                <Image Grid.Column="0"
                                       Source="{Binding NativeIcon}"
                                       Width="32"
                                       Height="32"
                                       VerticalAlignment="Center"
                                       Margin="0,0,12,0"
                                       RenderOptions.BitmapScalingMode="HighQuality"
                                       Visibility="{Binding NativeIcon, Converter={StaticResource IconToVis}, ConverterParameter=Native}"/>
                                
                                <!-- IcÃ´ne emoji (fallback) -->
                                <TextBlock Grid.Column="0"
                                           Text="{Binding DisplayIcon}"
                                           FontFamily="Segoe UI Emoji"
                                           FontSize="24"
                                           VerticalAlignment="Center"
                                           Margin="0,0,12,0"
                                           Visibility="{Binding NativeIcon, Converter={StaticResource IconToVis}, ConverterParameter=Emoji}"/>
                                
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Name}"
                                               FontSize="14"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Text="{Binding Description}"
                                               FontSize="11"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               TextTrimming="CharacterEllipsis"
                                               Margin="0,2,0,0"/>
                                </StackPanel>
                                
                                <!-- Raccourcis contextuels quand sÃ©lectionnÃ© -->
                                <StackPanel Grid.Column="2" 
                                            Orientation="Horizontal"
                                            VerticalAlignment="Center"
                                            Visibility="{Binding IsSelected, 
                                                RelativeSource={RelativeSource AncestorType=ListBoxItem},
                                                Converter={StaticResource BoolToVis}}">
                                    <!-- Ctrl+Enter pour Admin (apps/scripts) -->
                                    <Border Background="{DynamicResource HoverBrush}"
                                            CornerRadius="3"
                                            Padding="4,2"
                                            Margin="0,0,4,0"
                                            ToolTip="ExÃ©cuter en tant qu'administrateur"
                                            Visibility="{Binding Type, Converter={StaticResource TypeToMenuVis}, ConverterParameter=RunAsAdmin}">
                                        <TextBlock Text="Ctrl+â†µ Admin"
                                                   FontSize="9"
                                                   Foreground="{DynamicResource TextTertiaryBrush}"/>
                                    </Border>
                                    <!-- Tab pour actions -->
                                    <Border Background="{DynamicResource HoverBrush}"
                                            CornerRadius="3"
                                            Padding="4,2"
                                            Margin="0,0,4,0"
                                            ToolTip="Afficher les actions">
                                        <TextBlock Text="Tab"
                                                   FontSize="9"
                                                   Foreground="{DynamicResource TextTertiaryBrush}"/>
                                    </Border>
                                    <!-- Enter pour ouvrir -->
                                    <TextBlock Text="â†µ"
                                               FontSize="10"
                                               Foreground="{DynamicResource TextTertiaryBrush}"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                
                <!-- Panneau de prÃ©visualisation -->
                <Border Grid.Column="1"
                        Width="280"
                        Background="{DynamicResource SurfaceAltBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1,0,0,0"
                        Visibility="{Binding ShowPreviewPanel, Converter={StaticResource BoolToVis}}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" 
                                  HorizontalScrollBarVisibility="Disabled">
                        <StackPanel Margin="12">
                            <!-- En-tÃªte avec nom du fichier -->
                            <TextBlock Text="{Binding CurrentPreview.FileName, FallbackValue='SÃ©lectionnez un Ã©lÃ©ment'}"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,8"/>
                            
                            <!-- Type / Extension / Langage -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                <Border Background="{DynamicResource HoverBrush}"
                                        CornerRadius="4"
                                        Padding="6,3"
                                        Visibility="{Binding CurrentPreview, Converter={StaticResource NullToVis}}">
                                    <TextBlock Text="{Binding CurrentPreview.LanguageDisplay}"
                                               FontSize="11"
                                               Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </Border>
                                <!-- Info lignes pour fichiers texte -->
                                <Border Background="{DynamicResource HoverBrush}"
                                        CornerRadius="4"
                                        Padding="6,3"
                                        Margin="6,0,0,0"
                                        Visibility="{Binding CurrentPreview.PreviewType, 
                                            Converter={StaticResource PreviewTypeToVis}, 
                                            ConverterParameter=Text}">
                                    <TextBlock Text="{Binding CurrentPreview.LinesInfo}"
                                               FontSize="11"
                                               Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </Border>
                            </StackPanel>
                            
                            <!-- PrÃ©visualisation Image -->
                            <Border CornerRadius="6"
                                    Margin="0,0,0,12"
                                    Visibility="{Binding CurrentPreview.PreviewType, 
                                        Converter={StaticResource PreviewTypeToVis}, 
                                        ConverterParameter=Image}">
                                <Image Source="{Binding CurrentPreview.ImagePreview}"
                                       MaxHeight="200"
                                       Stretch="Uniform"
                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                            </Border>
                            
                            <!-- Dimensions image -->
                            <TextBlock Text="{Binding CurrentPreview.ImageDimensions}"
                                       FontSize="11"
                                       Foreground="{DynamicResource TextTertiaryBrush}"
                                       Margin="0,0,0,8"
                                       Visibility="{Binding CurrentPreview.PreviewType, 
                                           Converter={StaticResource PreviewTypeToVis}, 
                                           ConverterParameter=Image}"/>
                            
                            <!-- PrÃ©visualisation Texte/Code -->
                            <Border Background="{DynamicResource CodeBackgroundBrush}"
                                    CornerRadius="6"
                                    Padding="8"
                                    MaxHeight="250"
                                    Margin="0,0,0,12"
                                    Visibility="{Binding CurrentPreview.PreviewType, 
                                        Converter={StaticResource PreviewTypeToVis}, 
                                        ConverterParameter=Text}">
                                <ScrollViewer VerticalScrollBarVisibility="Auto"
                                              HorizontalScrollBarVisibility="Auto">
                                    <TextBlock Text="{Binding CurrentPreview.TextContent}"
                                               FontFamily="Cascadia Code, Consolas, Courier New"
                                               FontSize="10"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               TextWrapping="NoWrap"/>
                                </ScrollViewer>
                            </Border>
                            
                            <!-- MÃ©tadonnÃ©es -->
                            <StackPanel Visibility="{Binding CurrentPreview, Converter={StaticResource NullToVis}}">
                                <TextBlock Text="MÃ‰TADONNÃ‰ES" 
                                           FontSize="10" 
                                           Foreground="{DynamicResource TextTertiaryBrush}"
                                           FontWeight="Bold"
                                           Margin="0,8,0,6"/>
                                
                                <!-- Taille -->
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Taille" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11"/>
                                    <TextBlock Grid.Column="1" 
                                               Text="{Binding CurrentPreview.FileSizeFormatted}" 
                                               Foreground="{DynamicResource TextPrimaryBrush}" 
                                               FontSize="11"/>
                                </Grid>
                                
                                <!-- Date crÃ©ation -->
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="CrÃ©Ã©" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11"/>
                                    <TextBlock Grid.Column="1" 
                                               Text="{Binding CurrentPreview.CreatedDateFormatted}" 
                                               Foreground="{DynamicResource TextPrimaryBrush}" 
                                               FontSize="11"
                                               TextWrapping="Wrap"/>
                                </Grid>
                                
                                <!-- Date modification -->
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="ModifiÃ©" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11"/>
                                    <TextBlock Grid.Column="1" 
                                               Text="{Binding CurrentPreview.ModifiedDateFormatted}" 
                                               Foreground="{DynamicResource TextPrimaryBrush}" 
                                               FontSize="11"
                                               TextWrapping="Wrap"/>
                                </Grid>
                                
                                <!-- Attributs -->
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Attributs" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11"/>
                                    <TextBlock Grid.Column="1" 
                                               Text="{Binding CurrentPreview.AttributesText}" 
                                               Foreground="{DynamicResource TextPrimaryBrush}" 
                                               FontSize="11"/>
                                </Grid>
                                
                                <!-- Chemin complet -->
                                <TextBlock Text="EMPLACEMENT" 
                                           FontSize="10" 
                                           Foreground="{DynamicResource TextTertiaryBrush}"
                                           FontWeight="Bold"
                                           Margin="0,12,0,6"/>
                                <TextBlock Text="{Binding CurrentPreview.FullPath}"
                                           FontSize="10"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           TextWrapping="Wrap"
                                           Cursor="Hand"
                                           MouseLeftButtonUp="PreviewPath_Click"
                                           ToolTip="Cliquez pour copier">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                                    <Setter Property="TextDecorations" Value="Underline"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                            
                            <!-- Message si pas de preview -->
                            <TextBlock Text="SÃ©lectionnez un fichier pour voir la prÃ©visualisation"
                                       FontSize="12"
                                       Foreground="#666"
                                       TextWrapping="Wrap"
                                       TextAlignment="Center"
                                       Margin="0,40,0,0"
                                       Visibility="{Binding CurrentPreview, Converter={StaticResource NullToVis}, ConverterParameter=Inverse}"/>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
                
                <!-- Panneau d'actions (Tab) -->
                <Border x:Name="ActionsPanel"
                        Grid.Column="0"
                        Grid.ColumnSpan="2"
                        Background="{DynamicResource SurfaceBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,1,0,0"
                        VerticalAlignment="Bottom"
                        Visibility="{Binding ShowActionsPanel, Converter={StaticResource BoolToVis}}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- En-tÃªte -->
                        <Border Grid.Row="0" Background="#252525" Padding="12,8">
                            <Grid>
                                <TextBlock Text="Actions disponibles"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           Foreground="#AAA"/>
                                <TextBlock Text="Ã‰chap pour fermer"
                                           FontSize="10"
                                           Foreground="#666"
                                           HorizontalAlignment="Right"/>
                            </Grid>
                        </Border>
                        
                        <!-- Liste des actions -->
                        <ListBox x:Name="ActionsList"
                                 Grid.Row="1"
                                 ItemsSource="{Binding AvailableActions}"
                                 SelectedIndex="{Binding SelectedActionIndex, Mode=TwoWay}"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 MaxHeight="200"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 MouseDoubleClick="ActionsList_MouseDoubleClick">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem" BasedOn="{StaticResource ActionItemStyle}"/>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate DataType="{x:Type models:FileAction}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding Icon}"
                                                   FontFamily="Segoe UI Emoji"
                                                   FontSize="16"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,10,0"/>
                                        
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}"
                                                       FontSize="13"
                                                       Foreground="White"/>
                                            <TextBlock Text="{Binding Description}"
                                                       FontSize="10"
                                                       Foreground="#888"
                                                       Visibility="{Binding Description, Converter={StaticResource NullToVis}}"/>
                                        </StackPanel>
                                        
                                        <Border Grid.Column="2"
                                                Background="#333"
                                                CornerRadius="3"
                                                Padding="6,2"
                                                VerticalAlignment="Center"
                                                Visibility="{Binding Shortcut, Converter={StaticResource NullToVis}}">
                                            <TextBlock Text="{Binding Shortcut}"
                                                       FontSize="10"
                                                       Foreground="#888"/>
                                        </Border>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>
                
                <!-- Hint en bas quand pas de rÃ©sultats -->
                <TextBlock Grid.Column="0"
                           Text="Tapez ':help' pour voir les commandes disponibles&#x0a;Utilisez ':find &lt;terme&gt;' pour rechercher dans tout le systÃ¨me"
                           Foreground="#555"
                           FontSize="11"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"
                           Margin="0,20,0,20"
                           Visibility="{Binding HasResults, Converter={StaticResource InverseBoolToVis}}"/>
            </Grid>
            
            <!-- Barre de statut -->
            <Border Grid.Row="2"
                    Background="{DynamicResource SurfaceAltBrush}"
                    CornerRadius="0,0,12,12"
                    Padding="12,6"
                    Visibility="{Binding HasResults, Converter={StaticResource BoolToVis}}">
                <Grid>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding Results.Count, StringFormat='{}{0} rÃ©sultat(s)'}"
                                   FontSize="10"
                                   Foreground="#666"/>
                        <TextBlock Text=" â€¢ "
                                   FontSize="10"
                                   Foreground="#444"/>
                        <TextBlock FontSize="10" Foreground="#666">
                            <Run Text="Enter"/>
                            <Run Text="Ouvrir" Foreground="#888"/>
                            <Run Text=" â”‚ "/>
                            <Run Text="Tab"/>
                            <Run Text="Actions" Foreground="#888"/>
                            <Run Text=" â”‚ "/>
                            <Run Text="Ctrl+Enter"/>
                            <Run Text="Admin" Foreground="#888"/>
                        </TextBlock>
                    </StackPanel>
                    
                    <!-- Indicateur d'indexation -->
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Visibility="{Binding IsIndexing, Converter={StaticResource BoolToVis}}">
                        <TextBlock Text="â³"
                                   FontSize="10"
                                   Margin="0,0,4,0"/>
                        <TextBlock Text="Indexation..."
                                   FontSize="10"
                                   Foreground="#888"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
