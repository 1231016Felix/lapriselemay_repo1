<UserControl x:Class="WallpaperManager.Widgets.DiskStorage.DiskStorageWidget"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:WallpaperManager.Widgets.DiskStorage">
    
    <UserControl.Resources>
        <SolidColorBrush x:Key="WidgetTextPrimary" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="WidgetTextSecondary" Color="#9CA3AF"/>
        <SolidColorBrush x:Key="ProgressBackground" Color="#374151"/>
        <local:PercentToArcConverter x:Key="ArcConverter"/>
    </UserControl.Resources>
    
    <Viewbox Stretch="Uniform" StretchDirection="Both">
        <Grid MinWidth="180" MinHeight="120" MaxWidth="350" MaxHeight="300">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Titre -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="&#xEDA2;" FontFamily="Segoe MDL2 Assets" FontSize="14" 
                           Foreground="{StaticResource WidgetTextPrimary}" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBlock Text="Stockage" FontSize="14" FontWeight="SemiBold" 
                           Foreground="{StaticResource WidgetTextPrimary}" VerticalAlignment="Center"/>
            </StackPanel>
            
            <!-- Liste des disques -->
            <ItemsControl Grid.Row="1" ItemsSource="{Binding Disks}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="50"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Graphique circulaire -->
                            <Grid Width="44" Height="44">
                                <!-- Fond -->
                                <Ellipse Stroke="{StaticResource ProgressBackground}" StrokeThickness="5" Fill="Transparent"/>
                                <!-- Arc de progression -->
                                <Path StrokeThickness="5" Fill="Transparent">
                                    <Path.Stroke>
                                        <SolidColorBrush Color="{Binding Color}"/>
                                    </Path.Stroke>
                                    <Path.Data>
                                        <PathGeometry>
                                            <PathFigure StartPoint="22,2">
                                                <ArcSegment Size="20,20" SweepDirection="Clockwise" IsLargeArc="{Binding UsedPercent, Converter={StaticResource ArcConverter}, ConverterParameter=IsLarge}">
                                                    <ArcSegment.Point>
                                                        <MultiBinding Converter="{StaticResource ArcConverter}">
                                                            <Binding Path="UsedPercent"/>
                                                        </MultiBinding>
                                                    </ArcSegment.Point>
                                                </ArcSegment>
                                            </PathFigure>
                                        </PathGeometry>
                                    </Path.Data>
                                </Path>
                                <!-- Pourcentage au centre -->
                                <TextBlock Text="{Binding UsedPercent, StringFormat={}{0:F0}%}" 
                                           FontSize="10" FontWeight="Bold" Foreground="{StaticResource WidgetTextPrimary}"
                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Grid>
                            
                            <!-- Infos disque -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="8,0,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Name}" FontSize="13" FontWeight="SemiBold" 
                                               Foreground="{StaticResource WidgetTextPrimary}"/>
                                    <TextBlock Text=" - " FontSize="11" Foreground="{StaticResource WidgetTextSecondary}"/>
                                    <TextBlock Text="{Binding Label}" FontSize="11" Foreground="{StaticResource WidgetTextSecondary}"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding FreeFormatted}" FontSize="11" Foreground="{StaticResource WidgetTextSecondary}"/>
                                    <TextBlock Text=" libre sur " FontSize="11" Foreground="{StaticResource WidgetTextSecondary}"/>
                                    <TextBlock Text="{Binding TotalFormatted}" FontSize="11" Foreground="{StaticResource WidgetTextSecondary}"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </Viewbox>
</UserControl>
