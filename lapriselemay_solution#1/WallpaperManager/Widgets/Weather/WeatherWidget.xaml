<UserControl x:Class="WallpaperManager.Widgets.Weather.WeatherWidget"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:WallpaperManager.Widgets.Weather">
    
    <UserControl.Resources>
        <SolidColorBrush x:Key="WidgetTextPrimary" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="WidgetTextSecondary" Color="#9CA3AF"/>
        <SolidColorBrush x:Key="AccentColor" Color="#6366F1"/>
        <SolidColorBrush x:Key="SeparatorColor" Color="#374151"/>
        
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <local:InverseBooleanToVisibilityConverter x:Key="InverseBoolToVis"/>
        <local:PrecipVisibilityConverter x:Key="PrecipVisibilityConverter"/>
        <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
    </UserControl.Resources>
    
    <Viewbox Stretch="Uniform" StretchDirection="Both">
        <Grid MinWidth="200" MinHeight="180" MaxWidth="400" MaxHeight="350">
            <!-- Loading -->
            <TextBlock Text="Chargement..." Foreground="{StaticResource WidgetTextSecondary}"
                       HorizontalAlignment="Center" VerticalAlignment="Center"
                       Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"/>
            
            <!-- Contenu principal -->
            <Grid Visibility="{Binding IsLoading, Converter={StaticResource InverseBoolToVis}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- En-tÃªte: Ville et derniÃ¨re mise Ã  jour -->
                <Grid Grid.Row="0" Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Text="{Binding City}" FontSize="13" FontWeight="SemiBold" 
                               Foreground="{StaticResource WidgetTextPrimary}"/>
                    
                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="âŸ³ " FontSize="9" Foreground="{StaticResource WidgetTextSecondary}"/>
                        <TextBlock Text="{Binding LastUpdatedFormatted}" FontSize="9" Foreground="{StaticResource WidgetTextSecondary}"/>
                    </StackPanel>
                </Grid>
                
                <!-- TempÃ©rature principale -->
                <Grid Grid.Row="1" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- IcÃ´ne mÃ©tÃ©o grande -->
                    <TextBlock Text="{Binding Icon}" FontSize="40" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <!-- TempÃ©rature -->
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Temperature, StringFormat={}{0:F0}}" 
                                       FontSize="32" FontWeight="Light" Foreground="{StaticResource WidgetTextPrimary}"/>
                            <TextBlock Text="Â°C" FontSize="16" FontWeight="Light" 
                                       Foreground="{StaticResource WidgetTextPrimary}" VerticalAlignment="Top" Margin="2,4,0,0"/>
                        </StackPanel>
                        
                        <!-- Condition -->
                        <TextBlock Text="{Binding Condition}" FontSize="11" 
                                   Foreground="{StaticResource WidgetTextSecondary}" Margin="0,-2,0,0"/>
                        
                        <!-- Ressenti -->
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Ressenti " FontSize="10" Foreground="{StaticResource WidgetTextSecondary}"/>
                            <TextBlock Text="{Binding FeelsLike, StringFormat={}{0:F0}Â°C}" FontSize="10" Foreground="{StaticResource WidgetTextSecondary}"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>
                
                <!-- DÃ©tails: HumiditÃ© et Vent -->
                <Grid Grid.Row="2" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- HumiditÃ© -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="ðŸ’§ " FontSize="12" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding Humidity}" FontSize="11" Foreground="{StaticResource WidgetTextPrimary}" VerticalAlignment="Center"/>
                        <TextBlock Text="%" FontSize="11" Foreground="{StaticResource WidgetTextPrimary}" VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- Vent -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="ðŸ’¨ " FontSize="12" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding WindSpeed, StringFormat={}{0:F0}}" FontSize="11" Foreground="{StaticResource WidgetTextPrimary}" VerticalAlignment="Center"/>
                        <TextBlock Text=" km/h " FontSize="11" Foreground="{StaticResource WidgetTextPrimary}" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding WindDirection}" FontSize="11" Foreground="{StaticResource WidgetTextSecondary}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
                
                <!-- SÃ©parateur et PrÃ©visions -->
                <Border Grid.Row="3" BorderThickness="0,1,0,0" BorderBrush="{StaticResource SeparatorColor}" Padding="0,6,0,0">
                    <ItemsControl ItemsSource="{Binding Forecasts}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Rows="1"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel HorizontalAlignment="Center">
                                    <!-- Jour -->
                                    <TextBlock Text="{Binding DayName}" FontSize="10" 
                                               Foreground="{StaticResource WidgetTextSecondary}"
                                               HorizontalAlignment="Center"/>
                                    
                                    <!-- IcÃ´ne -->
                                    <TextBlock Text="{Binding Icon}" FontSize="18" 
                                               HorizontalAlignment="Center" Margin="0,2"/>
                                    
                                    <!-- TempÃ©ratures -->
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding TempMax}" FontSize="10" Foreground="{StaticResource WidgetTextPrimary}"/>
                                        <TextBlock Text="Â°" FontSize="10" Foreground="{StaticResource WidgetTextPrimary}"/>
                                        <TextBlock Text=" " FontSize="10"/>
                                        <TextBlock Text="{Binding TempMin}" FontSize="10" Foreground="{StaticResource WidgetTextSecondary}"/>
                                        <TextBlock Text="Â°" FontSize="10" Foreground="{StaticResource WidgetTextSecondary}"/>
                                    </StackPanel>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Border>
            </Grid>
            
            <!-- Erreur -->
            <TextBlock Text="{Binding ErrorMessage}" Foreground="#EF4444" FontSize="10"
                       HorizontalAlignment="Center" VerticalAlignment="Bottom"
                       Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}"/>
        </Grid>
    </Viewbox>
</UserControl>
