<UserControl x:Class="WallpaperManager.Widgets.SystemMonitor.SystemMonitorWidget"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:WallpaperManager.Widgets.SystemMonitor">
    
    <UserControl.Resources>
        <!-- Converter pour calculer la largeur des barres -->
        <local:PercentToWidthConverter x:Key="WidthConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        
        <!-- Couleurs du widget -->
        <SolidColorBrush x:Key="WidgetTextPrimary" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="WidgetTextSecondary" Color="#9CA3AF"/>
        <SolidColorBrush x:Key="CpuColor" Color="#6366F1"/>
        <SolidColorBrush x:Key="RamColor" Color="#10B981"/>
        <SolidColorBrush x:Key="GpuColor" Color="#F59E0B"/>
        <SolidColorBrush x:Key="NetworkColor" Color="#EC4899"/>
        <SolidColorBrush x:Key="ProgressBackground" Color="#374151"/>
        
        <!-- Converter pour inverser booléen -->
        <local:InverseBoolConverter x:Key="InverseBool"/>
    </UserControl.Resources>
    
    <Viewbox Stretch="Uniform" StretchDirection="Both">
        <Grid MinWidth="200" MinHeight="140" MaxWidth="400" MaxHeight="300">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Titre -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="&#xE9D9;" FontFamily="Segoe MDL2 Assets" FontSize="14" 
                           Foreground="{StaticResource WidgetTextPrimary}" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBlock Text="System Monitor" FontSize="14" FontWeight="SemiBold" 
                           Foreground="{StaticResource WidgetTextPrimary}" VerticalAlignment="Center"/>
            </StackPanel>
            
            <!-- Métriques -->
            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- CPU -->
                <Grid Grid.Row="0" Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Text="&#xE7F4;" FontFamily="Segoe MDL2 Assets" FontSize="16" 
                               Foreground="{StaticResource CpuColor}" VerticalAlignment="Center" Margin="0,0,6,0" Grid.RowSpan="2"/>
                    
                    <TextBlock Grid.Column="1" Text="CPU" FontSize="11" FontWeight="SemiBold" 
                               Foreground="{StaticResource WidgetTextPrimary}" VerticalAlignment="Center"/>
                    
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding CpuUsage, StringFormat={}{0:F0}}" 
                                   FontSize="14" FontWeight="Bold" Foreground="{StaticResource CpuColor}"/>
                        <TextBlock Text="%" FontSize="14" FontWeight="Bold" Foreground="{StaticResource CpuColor}"/>
                    </StackPanel>
                    
                    <!-- Barre CPU -->
                    <Grid x:Name="CpuBarContainer" Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" Height="5" Margin="0,2,0,0">
                        <Border Background="{StaticResource ProgressBackground}" CornerRadius="2"/>
                        <Border Background="{StaticResource CpuColor}" CornerRadius="2" HorizontalAlignment="Left">
                            <Border.Width>
                                <MultiBinding Converter="{StaticResource WidthConverter}">
                                    <Binding Path="CpuUsage"/>
                                    <Binding Path="ActualWidth" ElementName="CpuBarContainer"/>
                                </MultiBinding>
                            </Border.Width>
                        </Border>
                    </Grid>
                </Grid>
                
                <!-- RAM -->
                <Grid Grid.Row="1" Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Text="&#xE950;" FontFamily="Segoe MDL2 Assets" FontSize="16" 
                               Foreground="{StaticResource RamColor}" VerticalAlignment="Center" Margin="0,0,6,0" Grid.RowSpan="2"/>
                    
                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="RAM" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource WidgetTextPrimary}"/>
                        <TextBlock Text=" " FontSize="10" Visibility="{Binding IsCompactMode, Converter={StaticResource InverseBool}}"/>
                        <TextBlock Text="{Binding RamUsedGb, StringFormat={}{0:F1}}" FontSize="10" Foreground="{StaticResource WidgetTextSecondary}" 
                                   Visibility="{Binding IsCompactMode, Converter={StaticResource InverseBool}}"/>
                        <TextBlock Text="/" FontSize="10" Foreground="{StaticResource WidgetTextSecondary}"
                                   Visibility="{Binding IsCompactMode, Converter={StaticResource InverseBool}}"/>
                        <TextBlock Text="{Binding RamTotalGb, StringFormat={}{0:F0}}" FontSize="10" Foreground="{StaticResource WidgetTextSecondary}"
                                   Visibility="{Binding IsCompactMode, Converter={StaticResource InverseBool}}"/>
                        <TextBlock Text=" GB" FontSize="10" Foreground="{StaticResource WidgetTextSecondary}"
                                   Visibility="{Binding IsCompactMode, Converter={StaticResource InverseBool}}"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding RamUsage, StringFormat={}{0:F0}}" 
                                   FontSize="14" FontWeight="Bold" Foreground="{StaticResource RamColor}"/>
                        <TextBlock Text="%" FontSize="14" FontWeight="Bold" Foreground="{StaticResource RamColor}"/>
                    </StackPanel>
                    
                    <!-- Barre RAM -->
                    <Grid x:Name="RamBarContainer" Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" Height="5" Margin="0,2,0,0">
                        <Border Background="{StaticResource ProgressBackground}" CornerRadius="2"/>
                        <Border Background="{StaticResource RamColor}" CornerRadius="2" HorizontalAlignment="Left">
                            <Border.Width>
                                <MultiBinding Converter="{StaticResource WidthConverter}">
                                    <Binding Path="RamUsage"/>
                                    <Binding Path="ActualWidth" ElementName="RamBarContainer"/>
                                </MultiBinding>
                            </Border.Width>
                        </Border>
                    </Grid>
                </Grid>
                
                <!-- GPU -->
                <Grid Grid.Row="2" Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Text="&#xE7FC;" FontFamily="Segoe MDL2 Assets" FontSize="16" 
                               Foreground="{StaticResource GpuColor}" VerticalAlignment="Center" Margin="0,0,6,0" Grid.RowSpan="2"/>
                    
                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="GPU" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource WidgetTextPrimary}"/>
                        <TextBlock Text=" " FontSize="10" Visibility="{Binding IsCompactMode, Converter={StaticResource InverseBool}}"/>
                        <TextBlock Text="{Binding GpuMemoryUsedMb, StringFormat={}{0:F0}}" FontSize="10" Foreground="{StaticResource WidgetTextSecondary}"
                                   Visibility="{Binding IsCompactMode, Converter={StaticResource InverseBool}}"/>
                        <TextBlock Text=" MB" FontSize="10" Foreground="{StaticResource WidgetTextSecondary}"
                                   Visibility="{Binding IsCompactMode, Converter={StaticResource InverseBool}}"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding GpuUsage, StringFormat={}{0:F0}}" 
                                   FontSize="14" FontWeight="Bold" Foreground="{StaticResource GpuColor}"/>
                        <TextBlock Text="%" FontSize="14" FontWeight="Bold" Foreground="{StaticResource GpuColor}"/>
                    </StackPanel>
                    
                    <!-- Barre GPU -->
                    <Grid x:Name="GpuBarContainer" Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" Height="5" Margin="0,2,0,0">
                        <Border Background="{StaticResource ProgressBackground}" CornerRadius="2"/>
                        <Border Background="{StaticResource GpuColor}" CornerRadius="2" HorizontalAlignment="Left">
                            <Border.Width>
                                <MultiBinding Converter="{StaticResource WidthConverter}">
                                    <Binding Path="GpuUsage"/>
                                    <Binding Path="ActualWidth" ElementName="GpuBarContainer"/>
                                </MultiBinding>
                            </Border.Width>
                        </Border>
                    </Grid>
                </Grid>
                
                <!-- Réseau -->
                <Grid Grid.Row="3" Margin="0,2,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Text="&#xE839;" FontFamily="Segoe MDL2 Assets" FontSize="16" 
                               Foreground="{StaticResource NetworkColor}" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    
                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="↓ " FontSize="11" Foreground="{StaticResource NetworkColor}"/>
                        <TextBlock Text="{Binding DownloadSpeedFormatted}" FontSize="11" Foreground="{StaticResource WidgetTextPrimary}"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right">
                        <TextBlock Text="↑ " FontSize="11" Foreground="{StaticResource NetworkColor}"/>
                        <TextBlock Text="{Binding UploadSpeedFormatted}" FontSize="11" Foreground="{StaticResource WidgetTextPrimary}"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>
    </Viewbox>
</UserControl>
